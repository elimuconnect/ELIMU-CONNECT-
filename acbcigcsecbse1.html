<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Allow indexing -->
  <meta name="robots" content="index, follow" />

  <!-- Google Verification -->
  <meta name="google-site-verification" content="ZuK2pvozDS96vm0_IRjSYEsTqSdC8FJCIgJdAitGf0U" />


 <title>Free Tuition ‚Äì Free Online Math Tutor Kenya, English Tutor Kenya & Integrated Science Tutor Kenya (Grades 7‚Äì9)</title>


  <!-- SEO Meta -->
  <meta name="description" content="Smart Tutor Kenya offers FREE live online tuition for CBC & IGCSE Grades 7‚Äì9 in Math, English, and Integrated Science. Join daily lessons in Nairobi, Mombasa, Rift Valley, and across Kenya. Perfect for homeschooling and online learners.">
  <meta name="keywords" content="Smart Tutor Kenya, free online Math tutor Kenya, free online English tutor Kenya, free online Integrated Science tutor Kenya, online tuition Nairobi, online tuition Mombasa, online tuition Rift Valley, CBC tuition Kenya, IGCSE tuition Kenya, homeschooling Kenya, Grade 7 tuition, Grade 8 tuition, Grade 9 tuition, best online tutors Kenya">
  <meta name="author" content="Smart Tutor by Elimu Connect">

  <!-- Open Graph (Social Preview) -->
  <meta property="og:title" content="Smart Tutor ‚Äì Free Online Math, English & Integrated Science Tuition in Kenya (Grades 7‚Äì9)">
  <meta property="og:description" content="Join FREE daily online Math, English, and Integrated Science lessons for CBC & IGCSE Grades 7‚Äì9. Available in Nairobi, Mombasa, Rift Valley, and across Kenya. Perfect for homeschooling and online learning.">
  <meta property="og:url" content="https://elimuconnect.github.io/ELIMU-CONNECT-/alessonsbest">
  <meta property="og:type" content="website">
  <meta property="og:image" content="https://elimuconnect.github.io/ELIMU-CONNECT-/images/smart-tutor-banner.png">

  <!-- Twitter Card -->
  <meta name="twitter:card" content="summary_large_image">
  <meta name="twitter:title" content="Smart Tutor ‚Äì Free Online Math, English & Integrated Science Tuition in Kenya">
  <meta name="twitter:description" content="Daily live Math, English & Integrated Science lessons for CBC & IGCSE Grades 7‚Äì9 in Nairobi, Mombasa, Rift Valley, and across Kenya. FREE tuition for all students.">
  <meta name="twitter:image" content="https://elimuconnect.github.io/ELIMU-CONNECT-/images/smart-tutor-banner.png">

  <!-- Structured Data (JSON-LD) -->
  <script type="application/ld+json">
  {
    "@context": "https://schema.org",
    "@type": "EducationalOrganization",
    "name": "Smart Tutor",
    "url": "https://elimuconnect.github.io/ELIMU-CONNECT-/alessonsbest",
    "logo": "https://elimuconnect.github.io/ELIMU-CONNECT-/images/smart-tutor-logo.png",
    "description": "Smart Tutor Kenya provides FREE live online tuition for CBC & IGCSE Grades 7‚Äì9 in Math, English, and Integrated Science. Lessons available in Nairobi, Mombasa, Rift Valley, and across Kenya. Ideal for homeschooling and online learning.",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "KE"
    },
    "sameAs": [
      "https://elimuconnect.github.io/ELIMU-CONNECT-/"
    ],
    "department": [
      {
        "@type": "Course",
        "name": "Math Tuition Grade 7-9",
        "description": "Free online Math lessons for CBC & IGCSE students in Nairobi, Mombasa, Rift Valley, and across Kenya."
      },
      {
        "@type": "Course",
        "name": "English Tuition Grade 7-9",
        "description": "Free online English lessons for CBC & IGCSE students in Nairobi, Mombasa, Rift Valley, and across Kenya."
      },
      {
        "@type": "Course",
        "name": "Integrated Science Tuition Grade 7-9",
        "description": "Free online Integrated Science lessons for CBC & IGCSE students in Nairobi, Mombasa, Rift Valley, and across Kenya."
      }
    ]
  }
  </script>
  
<style>
* { box-sizing: border-box; }
html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right,#e0f7fa,#fce4ec);
}
#app { display: flex; flex-direction: column; height: 100vh; }
#toolbar {
  padding: 15px;
  background: #1976d2;
  color: white;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}
#toolbar button {
  background: white;
  color: #1976d2;
  padding: 12px 20px;
  border: none;
  border-radius: 30px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s ease;
}
#toolbar button:hover { background: #f0f0f0; }
#editor {
  flex: 1;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}
/* ‚úÖ NEW CARD STYLE */
.card {
  max-width: 90vw;
  width: 100%;
  margin: 20px auto;
  padding: 40px;
  background: white;
  border-radius: 25px;
  border: 2px solid #ccc; /* Added border for prominence */
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  font-size: 1.8em;
  line-height: 2;
  font-weight: bold;
  animation: fadeIn 1s ease;
  overflow-wrap: break-word;
  word-break: break-word;
  color: #1a237e;
  box-sizing: border-box;
  transition: all 0.3s ease-in-out; /* Smooth hover or layout changes */
}

/* Headings inside cards */
.card h2 {
  margin-top: 0;
  font-size: 2em;
  font-weight: bold;
}

/* Optional manual title colors */
.card h2.red    { color: #d81b60; }
.card h2.green  { color: #2e7d32; }
.card h2.blue   { color: #1565c0; }
.card h2.orange { color: #ef6c00; }
.card h2.purple { color: #6a1b9a; }

/* Automatic color cycling for h2s inside cards */
.card h2:nth-child(5n+1) { color: #d81b60; }
.card h2:nth-child(5n+2) { color: #2e7d32; }
.card h2:nth-child(5n+3) { color: #1565c0; }
.card h2:nth-child(5n+4) { color: #ef6c00; }
.card h2:nth-child(5n+5) { color: #6a1b9a; }

.card pre {
  white-space: pre-wrap;
  overflow-wrap: break-word;
  word-break: break-word;
  font-size: 1.6em;
  line-height: 2;
  font-weight: bold;
  color: #1a237e;
}

#status {
  padding: 15px;
  background: #388e3c;
  color: white;
  font-weight: bold;
  text-align: center;
  font-size: 16px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

 #toolbar {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
    padding: 10px;
    justify-content: center;
  }

  #toolbar button {
    padding: 12px;
    font-size: 16px;
    border: none;
    border-radius: 8px;
    background: #4CAF50;
    color: white;
    cursor: pointer;
    flex: 1 1 auto;
  }

  #toolbar button:hover {
    background: #45a049;
  }

  /* On phones ‚Üí 2 columns */
  @media (max-width: 600px) {
    #toolbar {
      display: grid;
      grid-template-columns: 1fr 1fr;
    }

    #toolbar button {
      width: 100%;
    }
  }

  .card {
    padding: 20px;
    font-size: 1.2em;
  }

  .card h2 {
    font-size: 1.4em;
  }

  .card pre {
    font-size: 1.15em;
  }

  #status {
    font-size: 15px;
    padding: 10px;
  }
}

/* Extra formatting helpers for lesson text */
.lesson-title {
  color: #d32f2f; /* Deep red */
  font-size: 1.2em;
  display: block;
  margin: 10px 0;
}
.subtopic {
  color: #1976d2; /* Blue */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.question {
  color: #f57c00; /* Orange */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.answer {
  color: #388e3c; /* Green */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.bullet {
  color: #6a1b9a; /* Purple dot */
  margin-right: 8px;
}
.point {
  color: #1a237e;
  display: block;
  margin-left: 20px;
}

.rating {
  margin-top: 20px;
  font-size: 2em;
  color: #ccc;            /* Default gray */
  display: inline-block;
  cursor: pointer;
  user-select: none;
}


.rating span {
  display: inline-block;       /* ensures each star is separate */
  width: 1.2em;                /* adjust to your star size */
  text-align: center;           /* center the star inside its box */
  transition: color 0.3s;
  user-select: none;
}

  .rating {
  touch-action: manipulation;  /* prevents mobile from interpreting swipe/zoom */
}

  .rating span {
  line-height: 1;  /* prevents vertical area being counted as clickable */
}

  
.rating span.active {
  color: gold;   /* clicked/persisted stars */
}
.rating span.hover {
  color: orange; /* temporary preview */
}


  .timetable {
  margin-top: 12px;
  background: #f9fbff;
  padding: 8px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.timetable h3 {
  margin: 0 0 6px;
  color: #1976d2;
  font-size: 1em;
}

.timetable table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85em; /* smaller font */
}

.timetable th {
  background: #1976d2;
  color: white;
  padding: 4px 6px; /* reduced padding */
  text-align: left;
  border: 1px solid #ccc;
}

.timetable td {
  padding: 4px 6px; /* reduced padding */
  border: 1px solid #ccc;
}

.timetable tr:nth-child(even) {
  background: #f1f6fb;
}

</style>
</head>
  <body>

<div id="app">

  <!-- Curriculum Selection -->
  <div id="curriculumSelect" style="text-align:center; margin-bottom:20px;">
    <h2>üìö Choose Your Math Curriculum</h2>
    <button onclick="chooseCurriculum('CBC')" style="margin:5px; padding:8px 15px;">üá∞üá™ CBC</button>
    <button onclick="chooseCurriculum('British')" style="margin:5px; padding:8px 15px;">üá¨üáß British</button>
    <button onclick="chooseCurriculum('CBSE')" style="margin:5px; padding:8px 15px;">üáÆüá≥ CBSE</button>
  </div>

  <!-- Main Tutor Section -->
  <div id="mainTutor" style="display:none;">

    <!-- Toolbar -->
    <div id="toolbar" style="text-align:center; margin-bottom:15px;">
      <button id="loginBtn">üîë Google Login</button>
      <button onclick="startTutor()">‚ñ∂Ô∏è Start Tutor</button>
      <button onclick="pauseTutor()">‚è∏Ô∏è Pause</button>
      <button onclick="resumeTutor()">‚ñ∂Ô∏è Resume</button>
      <button onclick="prevLesson()">‚¨ÖÔ∏è Back</button>
      <button onclick="nextLesson()">‚û°Ô∏è Next</button>
      <button onclick="contactWhatsApp()">üí¨ Customer Care</button>
    </div>

    <!-- Editor / Lesson Container -->
    <div id="editor">

      <!-- Phone Form -->
      <div id="phoneForm" style="display:none; text-align:center; padding:20px; margin-bottom:20px; border:1px solid #ccc; border-radius:10px; background:#f9f9f9;">
        <h2>üì± Enter Your Phone Number</h2>
        <p id="studentName"></p>
        <input type="text" id="phoneInput" placeholder="e.g. 07xx xxx xxx" style="padding:10px; font-size:1em; width:80%; max-width:300px; border:1px solid #aaa; border-radius:6px;">
        <br><br>
        <button onclick="savePhoneNumber()" style="padding:10px 20px; font-size:1em; border:none; border-radius:8px; background:#1976d2; color:white; cursor:pointer;">
          Save & Unlock Lessons
        </button>
      </div>

      <!-- Main Tutor Card -->
      <div class="card" style="padding:15px; border-radius:10px; background:#fff; box-shadow:0 2px 6px rgba(0,0,0,0.1);">

        <!-- Rating message container -->
        <div id="ratingMessage" style="display:none; color:#388e3c; font-weight:bold; margin-bottom:10px; opacity:0; transform:translateY(-10px); transition: all 0.5s ease;"></div>

        <h2>Welcome to Smart Math Tutor</h2>
        <p id="selectedCurriculum">Please select a curriculum above to start your Math lessons.</p>

        <!-- Weekly Math Timetable -->
        <div class="timetable" style="margin-top:15px;">
          <h3>üìÖ Weekly Math Timetable (Kenya time)</h3>
          <table style="width:100%; border-collapse:collapse;">
            <thead>
              <tr>
                <th style="border:1px solid #ccc; padding:5px;">Day</th>
                <th style="border:1px solid #ccc; padding:5px;">Time</th>
              </tr>
            </thead>
            <tbody>
              <tr><td>Mon ‚Äì Fri</td><td>5:30 PM ‚Äì 7:00 PM</td></tr>
              <tr><td>Saturday</td><td>8:00 AM ‚Äì 10:00 AM</td></tr>
              <tr><td>Sunday</td><td>No Math lessons scheduled</td></tr>
            </tbody>
          </table>
        </div>

        <!-- Rating -->
        <div class="rating" id="ratingStars" style="margin-top:15px;">
          <p style="font-size:0.6em; margin:5px 0;">Rate this Tutor:</p>
          <span data-v="1">‚òÖ</span>
          <span data-v="2">‚òÖ</span>
          <span data-v="3">‚òÖ</span>
          <span data-v="4">‚òÖ</span>
          <span data-v="5">‚òÖ</span>
        </div>
        <p id="ratingValue" style="font-size:0.6em;color:#1976d2;margin-top:6px;">
          Average Rating: <span id="avgRating">‚Äì</span> ‚òÖ
        </p>

        <!-- Lesson Request -->
        <div style="margin-top:20px; padding:10px; border-top:1px solid #ddd;">
          <h3>‚úçÔ∏è Request Math Lessons</h3>
          <textarea id="lessonRequest" placeholder="Type the Math topic you want Smart Tutor to cover‚Ä¶" style="width:100%; height:80px; border-radius:6px; border:1px solid #aaa; padding:8px; font-size:0.9em;"></textarea>
          <br><br>
          <button onclick="saveLessonRequest()" style="background:#28a745;color:white;padding:10px 15px;border:none;border-radius:6px;cursor:pointer;">
            üöÄ Submit Request
          </button>
          <p id="requestStatus" style="font-size:0.8em; margin-top:8px; font-weight:bold;"></p>
        </div>

        <!-- Lesson content container -->
        <div id="lessonContainer" style="margin-top:15px;"></div>
        <div id="status" style="margin-top:10px;">‚è≥ Ready‚Ä¶</div>

      </div>
    </div>
  </div>
</div>


<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>
<script>
const firebaseConfig = {
  apiKey: "AIzaSyCAiOSHmURDyAAYm5EmoomLkZ_Aud7iXIQ",
  authDomain: "cbc-general.firebaseapp.com",
  databaseURL: "https://cbc-general-default-rtdb.firebaseio.com",
  projectId: "cbc-general",
  storageBucket: "cbc-general.firebasestorage.app",
  messagingSenderId: "764732839741",
  appId: "1:764732839741:web:ab829af54839de91359754"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
/* -------------------------------------- */

const editor = document.getElementById("editor");
const status = document.getElementById("status");
const loginBtn = document.getElementById("loginBtn");

let user = null;

loginBtn.onclick = () => {
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
    .then(res => {
      user = res.user;
      status.textContent = `üëã Hi ${user.displayName}`;

      // Save/update user profile in database
      db.ref("students/" + user.uid).update({
        name: user.displayName,
        email: user.email
      });

      // Check if phone exists
      db.ref("students/" + user.uid).once("value").then(snap => {
        if (!snap.exists() || !snap.val().phone) {
          // Show phone number form
          document.getElementById("studentName").textContent =
            `Welcome ${user.displayName}, please enter your phone number:`;
          document.getElementById("phoneForm").style.display = "block";

          // Hide tutor card while phone is not saved
          document.querySelector(".card").style.display = "none";
        } else {
          // Phone exists, show main tutor card
          document.getElementById("phoneForm").style.display = "none";
          document.querySelector(".card").style.display = "block";
        }
      });
    })
    .catch(e => alert(e.message));
};

// Handle page reload: keep user logged in and check phone
auth.onAuthStateChanged(u => {
  user = u;
  if (user) {
    status.textContent = `üëã Hi ${user.displayName}`;

    db.ref("students/" + user.uid).once("value").then(snap => {
      if (!snap.exists() || !snap.val().phone) {
        document.getElementById("studentName").textContent =
          `Welcome ${user.displayName}, please enter your phone number:`;
        document.getElementById("phoneForm").style.display = "block";
        document.querySelector(".card").style.display = "none";
      } else {
        document.getElementById("phoneForm").style.display = "none";
        document.querySelector(".card").style.display = "block";
      }
    });
  } else {
    // User logged out
    status.textContent = "Please login to start tutoring.";
    document.getElementById("phoneForm").style.display = "none";
    document.querySelector(".card").style.display = "block";
  }
});
/* ---------- Curriculum + Grade Selection ---------- */
let selectedCurriculum = null;
let selectedGrade = null;
let currentLesson = 0;
let todayLessons = [];
let selectedVoice = null;
let utter = null;

function chooseCurriculum(curr) {
  selectedCurriculum = curr;
  document.getElementById("curriculumSelect").innerHTML = `
    <h2>üéì Choose Your Grade (${curr} Curriculum)</h2>
    ${[7,8,9,10,11,12].map(g=>`<button onclick="chooseGrade(${g})">Grade ${g}</button>`).join('')}
  `;
}

function chooseGrade(g) {
  selectedGrade = g;
  document.getElementById("curriculumSelect").style.display = "none";
  document.getElementById("mainTutor").style.display = "block";
  document.getElementById("selectedCurriculum").textContent = `üìò ${selectedCurriculum} ‚Äì Grade ${g}`;
  startLessonChecker();
}

/* ---------- Lessons by Curriculum + Grade ---------- */
const lessonsArray = {
  CBC: {
    7: {
      Mon: { Math: [`<h2>Grade 7 ‚Äî Integers</h2><p>Add and subtract integers.</p>`] },
      Tue: { Math: [`<h2>Grade 7 ‚Äî Fractions</h2><p>Equivalent fractions and operations.</p>`] },
      Wed: { Math: [`<h2>Grade 7 ‚Äî Decimals</h2><p>Place value and rounding decimals.</p>`] },
      Thu: { Math: [`<h2>Grade 7 ‚Äî Algebra</h2><p>Simple expressions and equations.</p>`] },
      Fri: { Math: [`<h2>Grade 7 ‚Äî Geometry</h2><p>Angles and triangles.</p>`] },
      Sat: { Math: [`<h2>Grade 7 ‚Äî Revision</h2><p>Practice questions on week topics.</p>`] },
      Sun: []
    },
    8: {
      Mon: { Math: [`<h2>Grade 8 ‚Äî Indices</h2><p>Understanding powers and roots.</p>`] },
      Tue: { Math: [`<h2>Grade 8 ‚Äî Ratios</h2><p>Simplifying and sharing ratios.</p>`] },
      Wed: { Math: [`<h2>Grade 8 ‚Äî Linear Equations</h2><p>Solving one-variable equations.</p>`] },
      Thu: { Math: [`<h2>Grade 8 ‚Äî Graphs</h2><p>Plotting and interpreting graphs.</p>`] },
      Fri: { Math: [`<h2>Grade 8 ‚Äî Geometry</h2><p>Angles, polygons, and circles.</p>`] },
      Sat: { Math: [`<h2>Grade 8 ‚Äî Revision</h2><p>Mixed practice tests.</p>`] },
      Sun: []
    },
    9: {
      Mon: { Math: [`<h2>Grade 9 ‚Äî Trigonometry</h2><p>Basics of sine, cosine, and tangent.</p>`] },
      Tue: { Math: [`<h2>Grade 9 ‚Äî Probability</h2><p>Simple probability problems.</p>`] },
      Wed: { Math: [`<h2>Grade 9 ‚Äî Algebra II</h2><p>Quadratic equations and factorization.</p>`] },
      Thu: { Math: [`<h2>Grade 9 ‚Äî Statistics</h2><p>Mean, median, mode.</p>`] },
      Fri: { Math: [`<h2>Grade 9 ‚Äî Geometry</h2><p>Circles and constructions.</p>`] },
      Sat: { Math: [`<h2>Grade 9 ‚Äî Revision</h2><p>Topic recap and test.</p>`] },
      Sun: []
    },
    10: {
      Mon: { Math: [`<h2>Grade 10 ‚Äî Surds</h2><p>Rationalizing denominators and simplifying surds.</p>`] },
      Tue: { Math: [`<h2>Grade 10 ‚Äî Logarithms</h2><p>Using laws of logarithms.</p>`] },
      Wed: { Math: [`<h2>Grade 10 ‚Äî Quadratic Equations</h2><p>Solving by formula and factorization.</p>`] },
      Thu: { Math: [`<h2>Grade 10 ‚Äî Trigonometry II</h2><p>Solving triangles.</p>`] },
      Fri: { Math: [`<h2>Grade 10 ‚Äî Statistics</h2><p>Standard deviation and variance.</p>`] },
      Sat: { Math: [`<h2>Grade 10 ‚Äî Revision</h2><p>Past paper practice.</p>`] },
      Sun: []
    },
    11: {
      Mon: { Math: [`<h2>Grade 11 ‚Äî Differentiation</h2><p>Basic derivatives and slopes.</p>`] },
      Tue: { Math: [`<h2>Grade 11 ‚Äî Integration</h2><p>Finding areas under curves.</p>`] },
      Wed: { Math: [`<h2>Grade 11 ‚Äî Sequences</h2><p>Arithmetic and geometric progressions.</p>`] },
      Thu: { Math: [`<h2>Grade 11 ‚Äî Probability II</h2><p>Combined events.</p>`] },
      Fri: { Math: [`<h2>Grade 11 ‚Äî Revision</h2><p>Past paper revision.</p>`] },
      Sat: { Math: [`<h2>Grade 11 ‚Äî Project Work</h2><p>Math modeling tasks.</p>`] },
      Sun: []
    },
    12: {
      Mon: { Math: [`<h2>Grade 12 ‚Äî Advanced Calculus</h2><p>Differentiation and Integration applications.</p>`] },
      Tue: { Math: [`<h2>Grade 12 ‚Äî Vectors</h2><p>3D vector operations.</p>`] },
      Wed: { Math: [`<h2>Grade 12 ‚Äî Matrices</h2><p>Solving simultaneous equations.</p>`] },
      Thu: { Math: [`<h2>Grade 12 ‚Äî Probability III</h2><p>Binomial and normal distributions.</p>`] },
      Fri: { Math: [`<h2>Grade 12 ‚Äî Revision</h2><p>KCSE-level tests.</p>`] },
      Sat: { Math: [`<h2>Grade 12 ‚Äî Final Mock</h2><p>Comprehensive practice test.</p>`] },
      Sun: []
    }
  },

  British: {
    7: { Mon: { Math: [`<h2>Grade 7 (UK) ‚Äî Fractions</h2><p>Adding and simplifying fractions.</p>`] } },
    8: { Mon: { Math: [`<h2>Grade 8 (UK) ‚Äî Decimals</h2><p>Ordering and rounding decimals.</p>`] } },
    9: { Mon: { Math: [`<h2>Grade 9 (UK) ‚Äî Algebra</h2><p>Forming and solving equations.</p>`] } },
    10: { Mon: { Math: [`<h2>Grade 10 (UK) ‚Äî Trigonometry</h2><p>SOH-CAH-TOA applications.</p>`] } },
    11: { Mon: { Math: [`<h2>Grade 11 (UK) ‚Äî Graphs</h2><p>Functions and gradients.</p>`] } },
    12: { Mon: { Math: [`<h2>Grade 12 (UK) ‚Äî Calculus</h2><p>Differentiation and integration basics.</p>`] } }
  },

  CBSE: {
    7: { Mon: { Math: [`<h2>Grade 7 (CBSE) ‚Äî Integers</h2><p>Operations with integers.</p>`] } },
    8: { Mon: { Math: [`<h2>Grade 8 (CBSE) ‚Äî Algebra</h2><p>Basic algebraic identities.</p>`] } },
    9: { Mon: { Math: [`<h2>Grade 9 (CBSE) ‚Äî Geometry</h2><p>Triangles and quadrilaterals.</p>`] } },
    10: { Mon: { Math: [`<h2>Grade 10 (CBSE) ‚Äî Trigonometry</h2><p>Height and distance problems.</p>`] } },
    11: { Mon: { Math: [`<h2>Grade 11 (CBSE) ‚Äî Probability</h2><p>Events and outcomes.</p>`] } },
    12: { Mon: { Math: [`<h2>Grade 12 (CBSE) ‚Äî Calculus</h2><p>Integrals and derivatives.</p>`] } }
  }
};

/* ---------- Timetable (Same for All) ---------- */
const timetables = {
  Mon: [{ subject: "Math", start: "17:30", end: "19:00" }],
  Tue: [{ subject: "Math", start: "17:30", end: "19:00" }],
  Wed: [{ subject: "Math", start: "17:30", end: "19:00" }],
  Thu: [{ subject: "Math", start: "17:30", end: "19:00" }],
  Fri: [{ subject: "Math", start: "17:30", end: "19:00" }],
  Sat: [{ subject: "Math", start: "08:00", end: "10:00" }],
  Sun: []
};

/* ---------- Voice ---------- */
function getVoice(){
  const voices = speechSynthesis.getVoices();
  return voices.find(v=>v.lang.startsWith("en-ke") && v.name.toLowerCase().includes("female"))
      || voices.find(v=>v.lang.startsWith("en-gb"))
      || voices[0];
}
function speak(html){
  const text = new DOMParser().parseFromString(html, "text/html").body.textContent;
  speechSynthesis.cancel();
  utter = new SpeechSynthesisUtterance(text);
  utter.voice = selectedVoice;
  utter.rate = 0.85;
  speechSynthesis.speak(utter);
}

/* ---------- Start Tutor ---------- */
function startTutor() {
  if (!selectedCurriculum || !selectedGrade) {
    alert("‚ö†Ô∏è Please choose both curriculum and grade first!");
    return;
  }

  selectedVoice = getVoice();
  const now = new Date();
  const kenyaTime = new Date(now.toLocaleString("en-US", { timeZone: "Africa/Nairobi" }));
  const day = kenyaTime.toLocaleDateString("en-US", { weekday: "short" });

  const lessons = lessonsArray[selectedCurriculum]?.[selectedGrade]?.[day]?.Math || [];
  const todaySchedule = timetables[day] || [];

  const inLesson = todaySchedule.some(slot => inTimeRange(slot.start, slot.end, kenyaTime));
  const lessonContainer = document.getElementById("lessonContainer");
  if (!lessonContainer) return;

  if (!inLesson) {
    lessonContainer.innerHTML = `
      <div class="lessonCard" style="color:#d32f2f;text-align:center;font-weight:bold;">
        ‚è∞ No active Math lesson right now.<br>
        Next lesson: ${todaySchedule.map(s => `${s.start} ‚Äì ${s.end}`).join(", ") || "No lesson today."}
      </div>`;
    status.textContent = "üïì Waiting for next lesson...";
    return;
  }

  if (lessons.length > 0) {
    lessonContainer.innerHTML = "";
    lessons.forEach((lessonHTML, i) => {
      const card = document.createElement("div");
      card.className = "lessonCard";
      card.innerHTML = `
        <h3>${selectedCurriculum} ‚Äì Grade ${selectedGrade} Lesson ${i + 1}</h3>
        ${lessonHTML}
        <button class="speakBtn" onclick="speakLesson(${i})">üîä Read Lesson</button>
      `;
      lessonContainer.appendChild(card);
    });
    status.textContent = `üéì Showing ${lessons.length} Math lesson(s)`;
    speak(lessons[0]);
  } else {
    lessonContainer.innerHTML = `<div class="lessonCard">üìò No Math lesson found for ${day}.</div>`;
  }
}

/* ---------- Speak Lesson ---------- */
function speakLesson(i){
  const lessons = lessonsArray[selectedCurriculum]?.[selectedGrade];
  if (!lessons) return;
  const now = new Date();
  const day = now.toLocaleDateString("en-US", { weekday: "short" });
  const lesson = lessons[day]?.Math?.[i];
  if (lesson) speak(lesson);
}

/* ---------- Periodic Checker ---------- */
function startLessonChecker() {
  if (!selectedCurriculum || !selectedGrade) return;
  startTutor();
  setInterval(startTutor, 60000);
}

/* ---------- Utility: Time Range ---------- */
function inTimeRange(start, end, now) {
  const [sH, sM] = start.split(":").map(Number);
  const [eH, eM] = end.split(":").map(Number);
  const s = new Date(now), e = new Date(now);
  s.setHours(sH, sM, 0, 0);
  e.setHours(eH, eM, 0, 0);
  return now >= s && now <= e;
}

// --- Full Features List ---
const appFeatures = [
  "üéì Affordable Live Online Tuition ‚Äì From just Ksh 200 per hour",
  "üë©‚Äçüè´ Live group tuition with real tutors from top Kenyan schools",
  "ü§ñ FREE AI-Powered Virtual Tutor ‚Äì 24/7 homework & exam help",
  "üì≤ Connect with nearby tutors for physical or online tuition",
  "üìù On-Demand Homework Help with AI + human tutors",
  "üí¨ Free student academic chats & forums across Kenya",
  "üìö Access 2000+ Video Lessons & 5000+ Quizzes",
  "üìñ 30,000+ CBC, IGCSE & KCSE Past Papers with Answers",
  "üìò 200+ Ebooks for Primary & Secondary Students",
  "üèÜ Weekly National Tests & Digital Certificates",
  "‚ùì 1000+ Question & Answer Pairs from Past Exams",
  "üéÆ 3 Fun Math Games & 3 Kiswahili/English Language Games",
  "üåç Career Guidance Tools for Kenyan Teens",
  "üóìÔ∏è AI-Powered Study Timetable Generator",
  "üìù Digital Notebook, Notes Organizer & Revision Tracker",
  "üßÆ Scientific Calculator + Graph Plotting Tools",
  "üî¢ Math, Chemistry & Physics Formula Tools",
  "üìñ Digital Dictionary & Kiswahili Kamusi",
  "üí° Similes, Metaphors, Methali & Nahau Reference Tools",
  "üßç‚Äç‚ôÇÔ∏è Human, Fish & Plant 3D Anatomy Simulators",
  "üß™ Interactive Digital Periodic Table",
  "‚öõÔ∏è Physics Concepts & Mole Calculators",
  "üß¨ Chemical Equations Balancer + Organic Chemistry Guide",
  "üìê Math Tools: Area, Volume, Trigonometry, Logarithms",
  "üí∞ Financial Math Tools: Tax, Interest, Binomial, Variation",
  "üó∫Ô∏è Geography Tools: Latitude/Longitude, Errors & Approximations",
  "üìä Advanced Statistics & Matrix Solvers",
  "‚ûó Calculus: Differentiation & Integration Calculators"
];

let featureIndex = 0;

/* ---------- SHOW CURRENT LESSON ---------- */
function showLesson() {
  if (currentLesson >= todayLessons.length) {
    editor.innerHTML = `
      <div class="card">
        <h2>‚úÖ All lessons for this slot are done!</h2>
        <p>Keep learning with <b>Smart Tutor by Elimu Connect</b>.</p>
      </div>
    `;
    return;
  }

  const lessonHtml = todayLessons[currentLesson];

  // Pick 3 rotating features
  const f1 = appFeatures[featureIndex % appFeatures.length];
  const f2 = appFeatures[(featureIndex + 1) % appFeatures.length];
  const f3 = appFeatures[(featureIndex + 2) % appFeatures.length];
  featureIndex += 3;

  editor.innerHTML = `
    <div class="card">
      ${lessonHtml}
      <hr>
      <div style="margin-top:10px; background:#f0f8ff; padding:10px; border-radius:10px; font-size:0.9em;">
        <b>üì≤ More with Elimu Connect App:</b>
        <ul style="margin:5px 0; padding-left:20px;">
          <li>${f1}</li>
          <li>${f2}</li>
          <li>${f3}</li>
        </ul>
        <a href="https://play.google.com/store/apps/details?id=elimuconnect.tuitioncentre" target="_blank">
          <button style="background:#28a745;color:white;padding:8px 12px;border:none;border-radius:6px;cursor:pointer;font-size:14px;">
            üöÄ Install App
          </button>
        </a>
      </div>
    </div>
  `;

  speak(lessonHtml);
}


// Realtime Database reference
const db = firebase.database();

const ratingStars = document.querySelectorAll(".rating span");
const avgRatingEl = document.getElementById("avgRating");

// Add a container for the delayed message
let ratingTimeout;
let ratingMessage = document.getElementById("ratingMessage");
if (!ratingMessage) {
  ratingMessage = document.createElement("div");
  ratingMessage.id = "ratingMessage";
  ratingMessage.style.cssText = `
    display:none; 
    color:#388e3c; 
    font-weight:bold; 
    margin-bottom:10px; 
    opacity:0; 
    transform:translateY(-10px); 
    transition: all 0.5s ease;
  `;
  document.querySelector(".card").prepend(ratingMessage);
}

// --- Visual star update (clicked/persisted) --- //
function updateStars(val) {
  ratingStars.forEach(s => {
    s.classList.remove("active");
    if (parseInt(s.dataset.v) <= val) {
      s.classList.add("active");
    }
  });
}

// --- Function to update average rating live --- //
function updateAverageRating() {
  db.ref("ratings").on("value", snapshot => {
    let total = 0, count = 0;
    snapshot.forEach(child => {
      total += child.val().rating;
      count++;
    });

    const avg = count ? (total / count).toFixed(1) : 0;

    // Update the display with average and number of ratings
    avgRatingEl.textContent = count 
      ? `${avg} (${count} students)` 
      : "No ratings yet";
  });
}

// Call it once to start listening for live updates
updateAverageRating();

// --- Hover preview only --- //
ratingStars.forEach(star => {
  star.addEventListener("mouseover", () => {
    const val = parseInt(star.dataset.v);
    ratingStars.forEach(s => {
      s.classList.toggle("hover", parseInt(s.dataset.v) <= val);
    });
  });

  star.addEventListener("mouseout", () => {
    ratingStars.forEach(s => s.classList.remove("hover"));
    if (user) {
      db.ref("students/" + user.uid).once("value", snap => {
        const val = snap.exists() ? snap.val().rating : 0;
        updateStars(val);
      });
    } else {
      updateStars(0); // keep gray when not logged in
    }
  });
});

// --- Click events to save rating --- //
ratingStars.forEach(star => {
  star.addEventListener("click", async () => {
    if (!user) return alert("‚ö†Ô∏è Login first to save rating.");
    const val = parseInt(star.dataset.v);

    // Save/update user's rating inside student profile
    await db.ref("students/" + user.uid).update({
      name: user.displayName,
      email: user.email,
      rating: val,
      ratingTimestamp: Date.now()
    });

    // Also save/update inside ratings node for averaging
    await db.ref("ratings/" + user.uid).set({
      rating: val,
      timestamp: Date.now()
    });

    // Update stars visually for this user
    updateStars(val);

    // Clear previous timeout if any
    if (ratingTimeout) clearTimeout(ratingTimeout);

    // Delay message 5 seconds
    ratingTimeout = setTimeout(() => {
      ratingMessage.textContent = `Thanks! You rated ${val}‚≠ê`;
      ratingMessage.style.display = "block";
      setTimeout(() => {
        ratingMessage.style.opacity = 1;
        ratingMessage.style.transform = "translateY(0)";
      }, 10);

      // Fade out after 3s
      setTimeout(() => {
        ratingMessage.style.opacity = 0;
        ratingMessage.style.transform = "translateY(-10px)";
        setTimeout(() => { ratingMessage.style.display = "none"; }, 500);
      }, 3000);

      ratingTimeout = null;
    }, 5000);
  });
});

// --- Restore student‚Äôs rating after login --- //
auth.onAuthStateChanged(u => {
  user = u;
  if (user) {
    db.ref("ratings/" + user.uid).once("value", snap => {
      if (snap.exists()) updateStars(snap.val().rating);
      else updateStars(0);
    });
  } else {
    updateStars(0);
  }
});



  
function savePhoneNumber() {
  const phone = document.getElementById("phoneInput").value.trim();
  if (!phone) {
    alert("‚ö†Ô∏è Please enter your phone number.");
    return;
  }

  db.ref("students/" + user.uid).update({
    phone: phone,
    timestamp: Date.now()
  }).then(() => {
    alert("‚úÖ Phone number saved! Lessons unlocked.");
    document.getElementById("phoneForm").style.display = "none";
    document.querySelector(".card").style.display = "block";
    editor.scrollIntoView({behavior: "smooth"});
  });
}




function prevLesson(){
  if(todayLessons.length && currentLesson>0){
    currentLesson--;
    showLesson();
  }
}
function nextLesson(){
  if(todayLessons.length && currentLesson<todayLessons.length-1){
    currentLesson++;
    showLesson();
  }
}
function pauseTutor(){speechSynthesis.pause();status.textContent="‚è∏Ô∏è Paused";}
function resumeTutor(){speechSynthesis.resume();status.textContent="‚ñ∂Ô∏è Resumed";}
function contactWhatsApp(){window.open("https://wa.me/254769255782","_blank");}



function saveLessonRequest() {
  if (!user) {
    alert("‚ö†Ô∏è Please login first to request a lesson.");
    return;
  }

  const requestText = document.getElementById("lessonRequest").value.trim();
  const statusEl = document.getElementById("requestStatus");

  if (!requestText) {
    statusEl.textContent = "‚ùå Please type your lesson request before submitting.";
    statusEl.style.color = "red";
    return;
  }

  // Save request under student node ‚Üí append new requests
  const requestsRef = db.ref("students/" + user.uid + "/requests").push();

  requestsRef.set({
    text: requestText,
    timestamp: Date.now()
  }).then(() => {
    statusEl.textContent = "‚úÖ Your request has been saved!";
    statusEl.style.color = "green";
    document.getElementById("lessonRequest").value = "";
  }).catch(err => {
    statusEl.textContent = "‚ùå Error: " + err.message;
    statusEl.style.color = "red";
  });
}
    
</script>
</body>
</html>
