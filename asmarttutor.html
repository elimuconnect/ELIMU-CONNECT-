<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Tutor ‚Äì Daily Live Lessons</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { box-sizing: border-box; }
html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right,#e0f7fa,#fce4ec);
}
#app { display: flex; flex-direction: column; height: 100vh; }
#toolbar {
  padding: 15px;
  background: #1976d2;
  color: white;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}
#toolbar button {
  background: white;
  color: #1976d2;
  padding: 12px 20px;
  border: none;
  border-radius: 30px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s ease;
}
#toolbar button:hover { background: #f0f0f0; }
#editor {
  flex: 1;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}
/* ‚úÖ NEW CARD STYLE */
.card {
  max-width: 90vw;
  width: 100%;
  margin: 20px auto;
  padding: 40px;
  background: white;
  border-radius: 25px;
  border: 2px solid #ccc; /* Added border for prominence */
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  font-size: 1.8em;
  line-height: 2;
  font-weight: bold;
  animation: fadeIn 1s ease;
  overflow-wrap: break-word;
  word-break: break-word;
  color: #1a237e;
  box-sizing: border-box;
  transition: all 0.3s ease-in-out; /* Smooth hover or layout changes */
}

/* Headings inside cards */
.card h2 {
  margin-top: 0;
  font-size: 2em;
  font-weight: bold;
}

/* Optional manual title colors */
.card h2.red    { color: #d81b60; }
.card h2.green  { color: #2e7d32; }
.card h2.blue   { color: #1565c0; }
.card h2.orange { color: #ef6c00; }
.card h2.purple { color: #6a1b9a; }

/* Automatic color cycling for h2s inside cards */
.card h2:nth-child(5n+1) { color: #d81b60; }
.card h2:nth-child(5n+2) { color: #2e7d32; }
.card h2:nth-child(5n+3) { color: #1565c0; }
.card h2:nth-child(5n+4) { color: #ef6c00; }
.card h2:nth-child(5n+5) { color: #6a1b9a; }

.card pre {
  white-space: pre-wrap;
  overflow-wrap: break-word;
  word-break: break-word;
  font-size: 1.6em;
  line-height: 2;
  font-weight: bold;
  color: #1a237e;
}

#status {
  padding: 15px;
  background: #388e3c;
  color: white;
  font-weight: bold;
  text-align: center;
  font-size: 16px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ‚úÖ Mobile adjustments */
@media (max-width: 600px) {
  #toolbar {
    flex-direction: column;
    gap: 8px;
    padding: 10px;
  }

  #toolbar button {
    width: 100%;
    font-size: 16px;
    padding: 10px;
  }

  .card {
    padding: 20px;
    font-size: 1.2em;
  }

  .card h2 {
    font-size: 1.4em;
  }

  .card pre {
    font-size: 1.15em;
  }

  #status {
    font-size: 15px;
    padding: 10px;
  }
}

/* Extra formatting helpers for lesson text */
.lesson-title {
  color: #d32f2f; /* Deep red */
  font-size: 1.2em;
  display: block;
  margin: 10px 0;
}
.subtopic {
  color: #1976d2; /* Blue */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.question {
  color: #f57c00; /* Orange */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.answer {
  color: #388e3c; /* Green */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.bullet {
  color: #6a1b9a; /* Purple dot */
  margin-right: 8px;
}
.point {
  color: #1a237e;
  display: block;
  margin-left: 20px;
}


.rating {
  margin-top: 20px;
  font-size: 2em;
  color: #ccc;            /* Default gray */
  display: inline-block;
  cursor: pointer;
  user-select: none;
}
.rating span {
  transition: color 0.3s;
}
.rating span.hover,
.rating span.selected {
  color: gold;            /* Highlighted star */
}


  .timetable {
  margin-top: 12px;
  background: #f9fbff;
  padding: 8px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.timetable h3 {
  margin: 0 0 6px;
  color: #1976d2;
  font-size: 1em;
}

.timetable table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85em; /* smaller font */
}

.timetable th {
  background: #1976d2;
  color: white;
  padding: 4px 6px; /* reduced padding */
  text-align: left;
  border: 1px solid #ccc;
}

.timetable td {
  padding: 4px 6px; /* reduced padding */
  border: 1px solid #ccc;
}

.timetable tr:nth-child(even) {
  background: #f1f6fb;
}

</style>
</head>
<body>
<div id="app">

  <div id="toolbar">
    <button id="loginBtn">üîë Google Login</button>
    <button onclick="startTutor()">‚ñ∂Ô∏è Start Tutor</button>
    <button onclick="pauseTutor()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeTutor()">‚ñ∂Ô∏è Resume</button>
    <button onclick="prevLesson()">‚¨ÖÔ∏è Back</button>
    <button onclick="nextLesson()">‚û°Ô∏è Next</button>
    <button onclick="contactWhatsApp()">üí¨ Customer Care</button>
  </div>

<div id="editor">

  <!-- Phone Number Form -->
  <div id="phoneForm" style="display:none; text-align:center; padding:20px; margin-bottom:20px; 
       border:1px solid #ccc; border-radius:10px; background:#f9f9f9;">
    <h2>üì± Enter Your Phone Number</h2>
    <p id="studentName"></p>
    <input type="text" id="phoneInput" placeholder="e.g. 07xx xxx xxx" 
           style="padding:10px; font-size:1em; width:80%; max-width:300px; border:1px solid #aaa; border-radius:6px;">
    <br><br>
    <button onclick="savePhoneNumber()" 
            style="padding:10px 20px; font-size:1em; border:none; border-radius:8px; background:#1976d2; color:white; cursor:pointer;">
      Save & Unlock Lessons
    </button>
  </div>

  <!-- Main Tutor Card -->
  <div class="card">
    <!-- Rating message container -->
    <div id="ratingMessage" style="display:none; color:#388e3c; font-weight:bold; margin-bottom:10px; 
         opacity:0; transform:translateY(-10px); transition: all 0.5s ease;"></div>
<h2>Welcome to Smart Tutor</h2>
<p>Login with Google to access live CBC lessons (Mon‚ÄìSat) with voice narration.</p>

<!-- Timetable -->
<div class="timetable">
  <h3>üìÖ Weekly Timetable (Kenya time)</h3>
  <table>
    <thead>
      <tr>
        <th>Day</th>
        <th>Subject</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="3">Mon ‚Äì Fri</td>
        <td>Math</td>
        <td>5:30 PM ‚Äì 7:00 PM</td>
      </tr>
      <tr>
        <td>Integrated Science</td>
        <td>7:30 PM ‚Äì 8:30 PM</td>
      </tr>
      <tr>
        <td>English</td>
        <td>9:00 PM ‚Äì 10:00 PM</td>
      </tr>

      <tr>
        <td rowspan="3">Saturday</td>
        <td>Math</td>
        <td>8:00 AM ‚Äì 10:00 AM</td>
      </tr>
      <tr>
        <td>Integrated Science</td>
        <td>10:30 AM ‚Äì 12:00 PM</td>
      </tr>
      <tr>
        <td>English</td>
        <td>2:00 PM ‚Äì 3:30 PM</td>
      </tr>

      <tr>
        <td>Sunday</td>
        <td colspan="2">No lessons scheduled</td>
      </tr>
    </tbody>
  </table>
</div>



    <div class="rating" id="ratingStars">
      <p style="font-size:0.6em;margin:5px 0;">Rate this Tutor:</p>
      <span data-v="1">‚òÖ</span>
      <span data-v="2">‚òÖ</span>
      <span data-v="3">‚òÖ</span>
      <span data-v="4">‚òÖ</span>
      <span data-v="5">‚òÖ</span>
    </div>

    <p id="ratingValue" style="font-size:0.6em;color:#1976d2;margin-top:6px;">
      Average Rating: <span id="avgRating">‚Äì</span> ‚òÖ
    </p>
  </div>
</div>

<div id="lessonContainer"></div>
<div id="status">‚è≥ Ready‚Ä¶</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>

<script>
/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCAiOSHmURDyAAYm5EmoomLkZ_Aud7iXIQ",
  authDomain: "cbc-general.firebaseapp.com",
  databaseURL: "https://cbc-general-default-rtdb.firebaseio.com",
  projectId: "cbc-general",
  storageBucket: "cbc-general.firebasestorage.app",
  messagingSenderId: "764732839741",
  appId: "1:764732839741:web:ab829af54839de91359754"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.database();
/* -------------------------------------- */

const editor = document.getElementById("editor");
const status = document.getElementById("status");
const loginBtn = document.getElementById("loginBtn");

let user = null;

/* ---------- LOGIN ---------- */
loginBtn.onclick = () => {
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
    .then(res => handleLogin(res.user))
    .catch(e => alert(e.message));
};

auth.onAuthStateChanged(u => {
  if (u) handleLogin(u);
});

function handleLogin(u){
  user = u;
  status.textContent = `üëã Hi ${user.displayName}`;
  
  db.ref("students/" + user.uid).once("value").then(snap => {
    if (!snap.exists() || !snap.val().phone) {
      document.getElementById("studentName").textContent =
        `Welcome ${user.displayName}, please enter your phone number:`;
      document.getElementById("phoneForm").style.display = "block";
      document.querySelector(".card").style.display = "none"; // hide tutor card
    }
  });
}

/* ---------- LESSON TIMETABLE ---------- */
const timetable = {
  Mon: [
    {subject: "Math", start: "17:30", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Tue: [
    {subject: "Math", start: "17:30", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Wed: [
    {subject: "Math", start: "15:30", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Thu: [
    {subject: "Math", start: "17:30", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Fri: [
    {subject: "Math", start: "17:30", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Sat: [
    {subject: "Math", start: "08:00", end: "10:00"},
    {subject: "Science", start: "10:30", end: "12:00"},
    {subject: "English", start: "14:00", end: "15:30"}
  ]
};

/* ---------- HELPER: Check if current time is in a slot ---------- */
function inTimeRange(start, end, now){
  const [sH, sM] = start.split(":").map(Number);
  const [eH, eM] = end.split(":").map(Number);
  const startTime = new Date(now); startTime.setHours(sH, sM, 0, 0);
  const endTime = new Date(now); endTime.setHours(eH, eM, 0, 0);
  return now >= startTime && now <= endTime;
}

/* ---------- LESSONS ---------- */
let lessonsArray = {
  Mon: { Math: ["<h2>Math Lesson 1</h2><p>Surds & Indices practice‚Ä¶</p>"], Science: ["<h2>Science Lesson 1</h2><p>Human Digestive System‚Ä¶</p>"], English: ["<h2>English Lesson 1</h2><p>Sentence Analysis‚Ä¶</p>"] },
  Tue: { Math: ["<h2>Math Lesson 1</h2><p>Quadratic Equations‚Ä¶</p>"], Science: ["<h2>Science Lesson 1</h2><p>Photosynthesis‚Ä¶</p>"], English: ["<h2>English Lesson 1</h2><p>Comprehension‚Ä¶</p>"] },
  Wed: { Math: ["<h2>Math Lesson 1</h2><p>Integers Intro‚Ä¶</p>"], Science: ["<h2>Science Lesson 1</h2><p>Photosynthesis‚Ä¶</p>"], English: ["<h2>English Lesson 1</h2><p>Grammar‚Ä¶</p>"] },
  Thu: { Math: ["<h2>Math Lesson 1</h2><p>Quadratic Equations‚Ä¶</p>"], Science: ["<h2>Science Lesson 1</h2><p>Plant Transport‚Ä¶</p>"], English: ["<h2>English Lesson 1</h2><p>Writing‚Ä¶</p>"] },
  Fri: { Math: ["<h2>Math Lesson 1</h2><p>Quadratics‚Ä¶</p>"], Science: ["<h2>Science Lesson 1</h2><p>Circulation‚Ä¶</p>"], English: ["<h2>English Lesson 1</h2><p>Comprehension‚Ä¶</p>"] },
  Sat: { Math: ["<h2>Math Lesson 1</h2><p>Quadratics‚Ä¶</p>"], Science: ["<h2>Science Lesson 1</h2><p>Respiration‚Ä¶</p>"], English: ["<h2>English Lesson 1</h2><p>Grammar‚Ä¶</p>"] }
};

let currentLesson = 0;
let todayLessons = [];
let selectedVoice = null;
let utter = null;

/* ---------- VOICE ---------- */
function getVoice(){
  const voices = speechSynthesis.getVoices();
  return voices.find(v=>v.lang.startsWith("en-ke") && v.name.toLowerCase().includes("female"))
         || voices.find(v=>v.lang.startsWith("en-ke"))
         || voices.find(v=>v.lang.startsWith("en-gb"))
         || voices[0];
}

function speak(html){
  const tmp = document.createElement("div");
  tmp.innerHTML = html;
  speechSynthesis.cancel();
  utter = new SpeechSynthesisUtterance(tmp.textContent);
  utter.voice = selectedVoice;
  utter.rate = 0.8;
  speechSynthesis.speak(utter);
}

/* ---------- START TUTOR ---------- */
function startTutor(){
  if(!user){ alert("‚ö†Ô∏è Please login first."); return; }

  db.ref("students/" + user.uid).once("value").then(snap => {
    if(!snap.exists() || !snap.val().phone){
      alert("‚ö†Ô∏è Enter your phone number first.");
      document.getElementById("phoneForm").style.display = "block";
      return;
    }

    const now = new Date();
    const kenyaTime = new Date(now.getTime() + (3*60 + now.getTimezoneOffset())*60000);
    const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    const todayName = days[kenyaTime.getDay()];

    const slots = timetable[todayName] || [];
    const currentSlot = slots.find(slot => inTimeRange(slot.start, slot.end, kenyaTime));

    if(!currentSlot){
      editor.innerHTML = "<div class='card'><h2>‚è≥ No active lesson right now. Check the timetable.</h2></div>";
      status.textContent = "No active lesson";
      return;
    }

    todayLessons = lessonsArray[todayName][currentSlot.subject] || [`<div><h2>${currentSlot.subject} Lesson</h2><p>Lesson coming soon.</p></div>`];
    
    const waitVoices = setInterval(()=>{
      if(speechSynthesis.getVoices().length){
        clearInterval(waitVoices);
        selectedVoice = getVoice();
        currentLesson = 0;
        showLesson();
      }
    }, 100);
  });
}

/* ---------- SHOW CURRENT LESSON ---------- */
function showLesson(){
  if(currentLesson >= todayLessons.length) {
    editor.innerHTML = "<div class='card'><h2>‚úÖ All lessons for this slot are done!</h2></div>";
    return;
  }
  const lessonHtml = todayLessons[currentLesson];
  editor.innerHTML = `<div class='card'>${lessonHtml}</div>`;
  speak(lessonHtml);
  currentLesson++;
}



</script>
</body>
</html>
