<!DOCTYPE html>
<html>
<head>
  <title>Titration Calculator</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background-color: #eef2f7;
    }
    h2 {
      color: #2c3e50;
    }
    input {
      margin: 5px;
      padding: 5px;
    }
    button {
      margin-top: 10px;
      padding: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .section {
      background: white;
      padding: 15px;
      margin-top: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px #ccc;
    }
    .step {
      margin-bottom: 10px;
    }
    .formula {
      font-weight: bold;
      color: #2c3e50;
    }




 .section { max-width:760px; padding:16px; border:1px solid #ddd; border-radius:8px; font-family:system-ui,Segoe UI,Roboto,Arial; }
  label{display:block; margin-top:8px; font-weight:600;}
  input[type=number]{width:160px; padding:6px; margin-top:4px;}
  .small{width:80px;}
  button{margin-top:12px; padding:8px 12px; border-radius:6px; cursor:pointer;}
  .result{margin-top:12px; background:#fafafa; border-radius:6px; padding:12px; font-size:14px;}
  .step{margin:8px 0; padding:8px; background:#fff; border-left:4px solid #0b61b6; border-radius:4px;}
  .formula{font-family:monospace; color:#222;}
  .error{color:#a00; font-weight:700;}
    
  </style>
</head>
<body>

<h2>Direct & Back Titration Calculator(Use values obtained from the simulators)</h2>

<div class="section">
  <h3>Direct Titration(calculating molarity)</h3>
  <label>Volume of acid (cm³):</label>
  <input type="number" id="directVolAcid" step="any"><br>
  <label>Concentration of acid (mol/dm³):</label>
  <input type="number" id="directConcAcid" step="any"><br>
  <label>Volume of base (cm³):</label>
  <input type="number" id="directVolBase" step="any"><br>
 
  
  
  <label>Mole Ratio Acid:Base = </label>
  <input type="number" id="directRatioAcid" value="1" style="width: 50px;"> :
  <input type="number" id="directRatioBase" value="1" style="width: 50px;"><br>

  <button onclick="calculateDirect()">Calculate Direct Titration</button>
  <div id="directResult"></div>
</div>










<div class="section">
  <h3>Back Titration — Auto solver (show steps)</h3>

  <label>Mass of substance (g)</label>
  <input type="number" id="mass" step="any" placeholder="e.g. 0.250">

  <label>Relative Formula Mass / RFM (g·mol⁻¹) — (leave blank to solve for it)</label>
  <input type="number" id="rfm" step="any" placeholder="e.g. 58.44">

  <label>Volume of acid added initially (cm³)</label>
  <input type="number" id="volAcid" step="any" placeholder="e.g. 25.0">

  <label>Concentration of acid(Original) (mol·dm⁻³)</label>
  <input type="number" id="concAcid" step="any" placeholder="e.g. 0.100">

  <label>Volume of base used in titration (cm³)</label>
  <input type="number" id="volBase" step="any" placeholder="e.g. 15.0">

  <label>Concentration of base (mol·dm⁻³)</label>
  <input type="number" id="concBase" step="any" placeholder="e.g. 0.100">

  <label>Mole ratio (Acid : Base)</label>
  <input type="number" id="ratioAbA" class="small" value="1" min="1"> :
  <input type="number" id="ratioAbB" class="small" value="1" min="1">

  <label>Moles (Acid : Substance)</label>
  <input type="number" id="ratioAsA" class="small" value="1" min="1"> :
  <input type="number" id="ratioAsB" class="small" value="1" min="1">

  <div>
    <button onclick="solveBackTitration()">Solve (calculate the ONE missing value)</button>
    <button onclick="fillExample()">Fill example values</button>
    <button onclick="clearAll()">Clear</button>
  </div>

  <div id="result" class="result" aria-live="polite"></div>
</div>

  


  

<div class="section">
  <h3>Redox Titration Calculator (Find missing concentration)</h3>
  <label>Volume of oxidant (cm³):</label>
  <input type="number" id="redoxVolOx" step="any"><br>
  <label>Concentration of oxidant (mol/dm³, leave empty if unknown):</label>
  <input type="number" id="redoxConcOx" step="any"><br>
  <label>Volume of reductant (cm³):</label>
  <input type="number" id="redoxVolRed" step="any"><br>
  <label>Concentration of reductant (mol/dm³, leave empty if unknown):</label>
  <input type="number" id="redoxConcRed" step="any"><br>
  <label>Mole Ratio Oxidant:Reductant = </label>
  <input type="number" id="redoxRatioOx" value="1" style="width: 50px;"> :
  <input type="number" id="redoxRatioRed" value="1" style="width: 50px;"><br>
  <button onclick="calculateRedox()">Calculate Redox Titration</button>
  <div id="redoxResult"></div>
</div>






<!-- Payment Access Modal -->
<div id="accessModal" style="
    position: fixed; top:0; left:0; width:100%; height:100%;
    background: rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center;
    z-index:9999; display:none;
">
  <div style="
      background:#fff; padding:25px 30px; border-radius:12px; max-width:400px;
      text-align:center; font-family:Segoe UI, sans-serif; color:#033a63;
      box-shadow:0 6px 20px rgba(0,0,0,0.2);
  ">
    <p id="accessMessage" style="font-size:1rem; margin-bottom:20px;"></p>
    <button id="accessBtn" style="
        background:#0078D7; color:#fff; border:none; padding:10px 18px;
        border-radius:8px; font-weight:600; cursor:pointer;
        transition:0.2s;
    ">OK</button>
  </div>
</div>

<!-- Countdown Display -->
<div id="accessCountdown" style="
    position: fixed; top: 100px; left: 10px; 
    background: #0078D7; color: #fff; padding: 12px 16px; 
    border-radius: 8px; font-family: 'Segoe UI', sans-serif; 
    font-weight:600; box-shadow: 2px 2px 12px rgba(0,0,0,0.2);
    z-index:999; text-align:center; display:none;
">
    Loading access info...
</div>

<script>
const PAYMENT_LINK = "https://paystack.shop/pay/avj3jjpk1k"; // New payment link
const FIRST_ACCESS_MINUTES = 10; // free trial
const ACCESS_DURATION = 24*60*60*1000; // 24 hours paid
const STORAGE_PREFIX = "titrationCalc_"; // unique prefix for Titrations Calculations

function getQueryParam(param) {
    const urlParams = new URLSearchParams(window.location.search);
    return urlParams.get(param);
}

function formatTime(ms){
    if(ms <= 0) return "00:00";
    let totalSec = Math.floor(ms/1000);
    let h = Math.floor(totalSec / 3600);
    let m = Math.floor((totalSec % 3600) / 60);
    let s = totalSec % 60;
    if(h > 0) return `${h}h ${m}m ${s}s`;
    return `${m.toString().padStart(2,'0')}:${s.toString().padStart(2,'0')}`;
}

// Access tracking
let lastPaid = parseInt(localStorage.getItem(STORAGE_PREFIX + 'lastPaidTime')) || 0;
let paidReference = localStorage.getItem(STORAGE_PREFIX + 'paidReference') || "";
let freeEnd = parseInt(localStorage.getItem(STORAGE_PREFIX + 'firstAccessEnd')) || 0;

const now = Date.now();
const reference = getQueryParam('reference');

// Only store new payment if reference is new
if(reference && reference !== paidReference){
    lastPaid = now;
    paidReference = reference;
    localStorage.setItem(STORAGE_PREFIX + 'lastPaidTime', lastPaid);
    localStorage.setItem(STORAGE_PREFIX + 'paidReference', paidReference);
}

// Only set free trial if not already set
if(!freeEnd){
    freeEnd = now + FIRST_ACCESS_MINUTES*60*1000;
    localStorage.setItem(STORAGE_PREFIX + 'firstAccessEnd', freeEnd);
}

// Countdown element
const countdownEl = document.getElementById('accessCountdown');

function showAccessModal(message, btnText="OK", callback=null){
    const modal = document.getElementById('accessModal');
    const msgEl = document.getElementById('accessMessage');
    const btn = document.getElementById('accessBtn');
    msgEl.innerHTML = message;
    btn.textContent = btnText;
    modal.style.display = "flex";
    btn.onclick = ()=> {
        modal.style.display = "none";
        if(callback) callback();
    };
}

function startCountdown(){
    countdownEl.style.display = "block";
    function updateCountdown(){
        const now = Date.now();
        if(lastPaid && now - lastPaid < ACCESS_DURATION){
            const remaining = ACCESS_DURATION - (now - lastPaid);
            countdownEl.textContent = `Paid access: ${formatTime(remaining)}`;
        } else if(freeEnd && now < freeEnd){
            const remaining = freeEnd - now;
            countdownEl.textContent = `Free trial: ${formatTime(remaining)}`;
        } else {
            countdownEl.textContent = `Access expired.`;
            showAccessModal(
                "Your access has expired. Please pay KSh 10 to continue using the Smart Elimu Connect Titrations Calculations tool.",
                "Pay Now",
                ()=>{ window.location.href = PAYMENT_LINK; }
            );
        }
    }
    updateCountdown();
    setInterval(updateCountdown, 1000);
}

// Start countdown
startCountdown();



  

  
  
 function format(num) {
  if (Math.abs(num) < 1 && num !== 0) {
    // For small numbers, show up to 6 decimal places (without trailing zeros)
    return parseFloat(num.toFixed(6)).toString();
  }
  return parseFloat(num.toFixed(4)).toString(); // For regular numbers
}

  function calculateDirect() {
    const vA = parseFloat(document.getElementById('directVolAcid').value) / 1000;
    const cA = parseFloat(document.getElementById('directConcAcid').value);
    const vB = parseFloat(document.getElementById('directVolBase').value) / 1000;
  
    const rA = parseFloat(document.getElementById('directRatioAcid').value);
    const rB = parseFloat(document.getElementById('directRatioBase').value);

    const steps = [];
    steps.push(`<div class='step formula'>Step 1: Calculate moles of acid = volume × concentration</div>`);
    const molesA = vA * cA;
    steps.push(`<div class='step'>${format(vA)} × ${cA} = ${format(molesA)} mol</div>`);

    steps.push(`<div class='step formula'>Step 2: Use mole ratio (Acid:Base = ${rA}:${rB})</div>`);
    const molesB = molesA * (rB / rA);
    steps.push(`<div class='step'>Moles of base = ${format(molesA)} × (${rB}/${rA}) = ${format(molesB)} mol</div>`);

    steps.push(`<div class='step formula'>Step 3: Calculate concentration of base = moles / volume</div>`);
    const concB = molesB / vB;
    steps.push(`<div class='step'>${format(molesB)} ÷ ${format(vB)} = ${format(concB)} mol/dm³</div>`);

    document.getElementById('directResult').innerHTML = steps.join('');
  }







  
  function getVal(id){ const v = document.getElementById(id).value.trim(); return v==="" ? null : parseFloat(v); }
function fmt(x, dp=6){ if (x===null || isNaN(x)) return '—'; return Number(x.toPrecision(8)).toString(); }
let resSteps = [];

function appendStep(html){ resSteps.push(`<div class="step">${html}</div>`); }

function solveBackTitration(){
  resSteps = [];
  const mass = getVal('mass');
  const rfm = getVal('rfm');
  const volA = getVal('volAcid');
  const cA = getVal('concAcid');
  const volB = getVal('volBase');
  const cB = getVal('concBase');

  const ratioAbA = getVal('ratioAbA') || 1;
  const ratioAbB = getVal('ratioAbB') || 1;
  const ratioAsA = getVal('ratioAsA') || 1;
  const ratioAsB = getVal('ratioAsB') || 1;

  const inputs = {mass, rfm, volA, cA, volB, cB};
  const blanks = Object.keys(inputs).filter(k => inputs[k] === null);

  const out = document.getElementById('result');
  if(blanks.length === 0){ out.innerHTML = `<div class="error">No field is blank. Leave ONE field blank to solve.</div>`; return; }
  if(blanks.length > 1){ out.innerHTML = `<div class="error">Please leave ONLY ONE field blank. Found ${blanks.length} missing.</div>`; return; }

  const unknown = blanks[0];

  try {
    // Step 1: compute molesBaseUsed if possible
    let nBase = null, acidEq = null;
    if(volB !== null && cB !== null) { nBase = volB/1000*cB; acidEq = nBase*(ratioAbA/ratioAbB); appendStep(`Moles of base used = ${fmt(nBase)} mol; Acid equivalent neutralised = ${fmt(acidEq)} mol`); }

    // Step 2: compute molesAcidInitial if possible
    let nAcidInitial = null;
    if(volA !== null && cA !== null){ nAcidInitial = volA/1000*cA; appendStep(`Moles of acid initially added = ${fmt(nAcidInitial)} mol`); }

    // Step 3: compute molesAcidReacted
    let nAcidReacted = null;
    if(nAcidInitial !== null && acidEq !== null){ nAcidReacted = nAcidInitial - acidEq; appendStep(`Moles of acid reacted with substance = ${fmt(nAcidReacted)} mol`); }

    // Step 4: compute molesSubstance
    let nSubstance = null;
    if(nAcidReacted !== null){ nSubstance = nAcidReacted*(ratioAsB/ratioAsA); appendStep(`Moles of substance = ${fmt(nSubstance)} mol`); }

    // Step 5: compute the unknown
    let result = null;
    switch(unknown){
      case 'mass':
        if(rfm===null) throw new Error('RFM is required to compute mass.');
        result = nSubstance*rfm;
        appendStep(`Mass = moles_substance × RFM = ${fmt(nSubstance)} × ${fmt(rfm)} = ${fmt(result)} g`);
        break;

      case 'rfm':
        if(mass===null) throw new Error('Mass is required to compute RFM.');
        result = mass/nSubstance;
        appendStep(`RFM = mass ÷ moles_substance = ${fmt(mass)} ÷ ${fmt(nSubstance)} = ${fmt(result)} g·mol⁻¹`);
        break;

      case 'volAcid':
        if(cA===null) throw new Error('Acid concentration is required to compute volume.');
        result = ((nAcidReacted || (mass/rfm)*(ratioAsA/ratioAsB)) + acidEq)/cA*1000;
        appendStep(`Volume of acid = (moles_acid_initial ÷ concAcid) × 1000 = ${fmt(result)} cm³`);
        break;

      case 'concAcid':
        if(volA===null) throw new Error('Acid volume is required to compute concentration.');
        result = ((nAcidReacted || (mass/rfm)*(ratioAsA/ratioAsB)) + acidEq)/(volA/1000);
        appendStep(`Concentration of acid = moles_acid_initial ÷ (volA/1000) = ${fmt(result)} mol·dm⁻³`);
        break;

      case 'volBase':
        if(cB===null) throw new Error('Base concentration is required to compute volume.');
        if(nAcidReacted===null) { if(mass===null||rfm===null) throw new Error('Mass and RFM needed to compute base volume'); nAcidReacted = mass/rfm*(ratioAsA/ratioAsB); }
        result = (nAcidReacted + acidEq)/cB*1000*(ratioAbB/ratioAbA);
        appendStep(`Volume of base = (acid equivalent ÷ concBase) × 1000 × ratioBase/ratioAcid = ${fmt(result)} cm³`);
        break;

      case 'concBase':
        if(volB===null) throw new Error('Base volume is required to compute concentration.');
        if(nAcidReacted===null) { if(mass===null||rfm===null) throw new Error('Mass and RFM needed to compute base concentration'); nAcidReacted = mass/rfm*(ratioAsA/ratioAsB); }
        result = (nAcidReacted + acidEq)/(volB/1000)*(ratioAbB/ratioAbA);
        appendStep(`Concentration of base = (acid equivalent ÷ volBase in dm³) × ratioBase/ratioAcid = ${fmt(result)} mol·dm⁻³`);
        break;

      default:
        throw new Error('Unknown field to solve.');
    }

    out.innerHTML = resSteps.join('');

  } catch(err){
    out.innerHTML = `<div class="error">Cannot solve: ${err.message}</div>`;
  }
}

function clearAll(){ ['mass','rfm','volAcid','concAcid','volBase','concBase'].forEach(id=>document.getElementById(id).value=''); document.getElementById('result').innerHTML=''; }
function fillExample(){
  document.getElementById('mass').value='0.250';
  document.getElementById('rfm').value='';
  document.getElementById('volAcid').value='25.0';
  document.getElementById('concAcid').value='0.100';
  document.getElementById('volBase').value='15.0';
  document.getElementById('concBase').value='0.100';
  document.getElementById('ratioAbA').value='1';
  document.getElementById('ratioAbB').value='1';
  document.getElementById('ratioAsA').value='1';
  document.getElementById('ratioAsB').value='1';
  document.getElementById('result').innerHTML='<div>Example values filled. Leave mass or RFM blank and press Solve.</div>';
}
  
  
  
  







  

function calculateRedox() {
  const vOx = parseFloat(document.getElementById('redoxVolOx').value) / 1000;
  const cOx = parseFloat(document.getElementById('redoxConcOx').value);
  const vRed = parseFloat(document.getElementById('redoxVolRed').value) / 1000;
  const cRed = parseFloat(document.getElementById('redoxConcRed').value);
  const rOx = parseFloat(document.getElementById('redoxRatioOx').value);
  const rRed = parseFloat(document.getElementById('redoxRatioRed').value);

  const steps = [];

  // Determine which concentration is missing
  let missing = null;
  if (!cOx && cRed) missing = 'oxidant';
  else if (!cRed && cOx) missing = 'reductant';
  else if (!cOx && !cRed) {
    document.getElementById('redoxResult').innerHTML = "<div class='step'>Error: Enter at least one concentration!</div>";
    return;
  }

  steps.push(`<div class='step formula'>Step 1: Use mole ratio Oxidant:Reductant = ${rOx}:${rRed}</div>`);

  if (missing === 'oxidant') {
    // Moles of reductant
    const molesRed = vRed * cRed;
    steps.push(`<div class='step'>Moles of reductant = ${format(vRed)} × ${format(cRed)} = ${format(molesRed)} mol</div>`);
    // Moles of oxidant
    const molesOx = molesRed * (rOx / rRed);
    steps.push(`<div class='step formula'>Moles of oxidant = moles of reductant × (${rOx}/${rRed})</div>`);
    steps.push(`<div class='step'>Moles of oxidant = ${format(molesRed)} × (${rOx}/${rRed}) = ${format(molesOx)} mol</div>`);
    // Concentration of oxidant
    const concOx = molesOx / vOx;
    steps.push(`<div class='step formula'>Concentration of oxidant = moles / volume</div>`);
    steps.push(`<div class='step'>${format(molesOx)} ÷ ${format(vOx)} = ${format(concOx)} mol/dm³</div>`);
  } else {
    // Moles of oxidant
    const molesOx = vOx * cOx;
    steps.push(`<div class='step'>Moles of oxidant = ${format(vOx)} × ${format(cOx)} = ${format(molesOx)} mol</div>`);
    // Moles of reductant
    const molesRed = molesOx * (rRed / rOx);
    steps.push(`<div class='step formula'>Moles of reductant = moles of oxidant × (${rRed}/${rOx})</div>`);
    steps.push(`<div class='step'>Moles of reductant = ${format(molesOx)} × (${rRed}/${rOx}) = ${format(molesRed)} mol</div>`);
    // Concentration of reductant
    const concRed = molesRed / vRed;
    steps.push(`<div class='step formula'>Concentration of reductant = moles / volume</div>`);
    steps.push(`<div class='step'>${format(molesRed)} ÷ ${format(vRed)} = ${format(concRed)} mol/dm³</div>`);
  }

  document.getElementById('redoxResult').innerHTML = steps.join('');
}



</script>

</body>
</html>









