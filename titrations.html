<!DOCTYPE html>
<html>
<head>
  <title>Titration Calculator</title>
  <style>
    body {
      font-family: Arial;
      padding: 20px;
      background-color: #eef2f7;
    }
    h2 {
      color: #2c3e50;
    }
    input {
      margin: 5px;
      padding: 5px;
    }
    button {
      margin-top: 10px;
      padding: 10px;
      background-color: #3498db;
      color: white;
      border: none;
      cursor: pointer;
    }
    button:hover {
      background-color: #2980b9;
    }
    .section {
      background: white;
      padding: 15px;
      margin-top: 20px;
      border-radius: 5px;
      box-shadow: 0 0 10px #ccc;
    }
    .step {
      margin-bottom: 10px;
    }
    .formula {
      font-weight: bold;
      color: #2c3e50;
    }
  </style>
</head>
<body>

<h2>Direct & Back Titration Calculator(Use values obtained from the simulators)</h2>

<div class="section">
  <h3>Direct Titration(calculating molarity)</h3>
  <label>Volume of acid (cm³):</label>
  <input type="number" id="directVolAcid" step="any"><br>
  <label>Concentration of acid (mol/dm³):</label>
  <input type="number" id="directConcAcid" step="any"><br>
  <label>Volume of base (cm³):</label>
  <input type="number" id="directVolBase" step="any"><br>
 
  
  
  <label>Mole Ratio Acid:Base = </label>
  <input type="number" id="directRatioAcid" value="1" style="width: 50px;"> :
  <input type="number" id="directRatioBase" value="1" style="width: 50px;"><br>

  <button onclick="calculateDirect()">Calculate Direct Titration</button>
  <div id="directResult"></div>
</div>





  <div class="section">
  <h3>Back Titration (Auto-Solve for Any Unknown)</h3>

  <label>Mass of substance (g):</label>
  <input type="number" id="auto_mass" step="any"><br>

  <label>Volume of acid added initially (cm³):</label>
  <input type="number" id="auto_volAcid" step="any"><br>

  <label>Concentration of acid (mol/dm³):</label>
  <input type="number" id="auto_concAcid" step="any"><br>

  <label>Volume of base used (cm³):</label>
  <input type="number" id="auto_volBase" step="any"><br>

  <label>Concentration of base (mol/dm³):</label>
  <input type="number" id="auto_concBase" step="any"><br>

  <label>Mole Ratio (Acid : Base)</label><br>
  <input type="number" id="auto_ratioAcidBase_A" value="1" style="width:50px"> :
  <input type="number" id="auto_ratioAcidBase_B" value="1" style="width:50px"><br>

  <label>Moles Acid : Substance</label>
  <input type="number" id="auto_ratioAcidSub_A" value="1" style="width:50px"> :
  <input type="number" id="auto_ratioAcidSub_B" value="1" style="width:50px"><br>

  <button onclick="autoBackTitration()">Auto Solve</button>
  <div id="auto_back_result"></div>
</div>




<div class="section">
  <h3>Redox Titration Calculator (Find missing concentration)</h3>
  <label>Volume of oxidant (cm³):</label>
  <input type="number" id="redoxVolOx" step="any"><br>
  <label>Concentration of oxidant (mol/dm³, leave empty if unknown):</label>
  <input type="number" id="redoxConcOx" step="any"><br>
  <label>Volume of reductant (cm³):</label>
  <input type="number" id="redoxVolRed" step="any"><br>
  <label>Concentration of reductant (mol/dm³, leave empty if unknown):</label>
  <input type="number" id="redoxConcRed" step="any"><br>
  <label>Mole Ratio Oxidant:Reductant = </label>
  <input type="number" id="redoxRatioOx" value="1" style="width: 50px;"> :
  <input type="number" id="redoxRatioRed" value="1" style="width: 50px;"><br>
  <button onclick="calculateRedox()">Calculate Redox Titration</button>
  <div id="redoxResult"></div>
</div>




<script>
const MAIN_LINK = "https://elimuconnect.github.io/ELIMU-CONNECT-/adirecttitback";
const PAYMENT_LINK = "https://paystack.shop/pay/57-iapq34s";

// Number of free loads allowed from any other source
const MAX_FREE_LOADS = 2;

// Track free loads
let freeLoadCount = parseInt(localStorage.getItem('freeLoadCount')) || 0;

// Check if this is main link access
const isMainLink = window.location.href === MAIN_LINK;

// Check if we came from main link redirect
const fromMainLink = document.referrer === MAIN_LINK;

if(isMainLink || fromMainLink){
    // Reset free load count when opened via main link
    localStorage.setItem('freeLoadCount', MAX_FREE_LOADS);
} else {
    if(freeLoadCount < MAX_FREE_LOADS){
        // Allow free load
        freeLoadCount++;
        localStorage.setItem('freeLoadCount', freeLoadCount);
        alert(`You have ${MAX_FREE_LOADS - freeLoadCount} free loads remaining for this tool.`);
    } else {
        // Block access
        document.body.innerHTML = `
            <div style="text-align:center; padding:50px; font-family:sans-serif;">
                <h2>Access Restricted</h2>
                <p>You have used your free loads. To continue, please open the simulator from the main link:</p>
                <a href="${MAIN_LINK}" style="font-size:1.2rem; color:#0078D7;">Open Main Simulator</a>
                <p>Or pay KSh 10 to get 24-hour access:</p>
                <a href="${PAYMENT_LINK}" style="font-size:1.2rem; color:#fff; background:#0078D7; padding:10px 20px; border-radius:6px; display:inline-block;">Pay Now</a>
            </div>
        `;
        throw new Error("Access blocked until main link or payment.");
    }
}






  
  
 function format(num) {
  if (Math.abs(num) < 1 && num !== 0) {
    // For small numbers, show up to 6 decimal places (without trailing zeros)
    return parseFloat(num.toFixed(6)).toString();
  }
  return parseFloat(num.toFixed(4)).toString(); // For regular numbers
}

  function calculateDirect() {
    const vA = parseFloat(document.getElementById('directVolAcid').value) / 1000;
    const cA = parseFloat(document.getElementById('directConcAcid').value);
    const vB = parseFloat(document.getElementById('directVolBase').value) / 1000;
  
    const rA = parseFloat(document.getElementById('directRatioAcid').value);
    const rB = parseFloat(document.getElementById('directRatioBase').value);

    const steps = [];
    steps.push(`<div class='step formula'>Step 1: Calculate moles of acid = volume × concentration</div>`);
    const molesA = vA * cA;
    steps.push(`<div class='step'>${format(vA)} × ${cA} = ${format(molesA)} mol</div>`);

    steps.push(`<div class='step formula'>Step 2: Use mole ratio (Acid:Base = ${rA}:${rB})</div>`);
    const molesB = molesA * (rB / rA);
    steps.push(`<div class='step'>Moles of base = ${format(molesA)} × (${rB}/${rA}) = ${format(molesB)} mol</div>`);

    steps.push(`<div class='step formula'>Step 3: Calculate concentration of base = moles / volume</div>`);
    const concB = molesB / vB;
    steps.push(`<div class='step'>${format(molesB)} ÷ ${format(vB)} = ${format(concB)} mol/dm³</div>`);

    document.getElementById('directResult').innerHTML = steps.join('');
  }






  function autoBackTitration() {

  const mass = get("auto_mass");
  const vA = get("auto_volAcid");
  const cA = get("auto_concAcid");
  const vB = get("auto_volBase");
  const cB = get("auto_concBase");

  const R_ab_A = get("auto_ratioAcidBase_A");
  const R_ab_B = get("auto_ratioAcidBase_B");
  const R_as_A = get("auto_ratioAcidSub_A");
  const R_as_B = get("auto_ratioAcidSub_B");

  const fields = { mass, vA, cA, vB, cB };
  const missing = Object.keys(fields).filter(k => fields[k] === null);

  if (missing.length > 1) {
    return show("Please leave ONLY ONE value blank.");
  }
  if (missing.length === 0) {
    // all values present → normal calculation
    const result = calculateAll(mass, vA, cA, vB, cB, R_ab_A, R_ab_B, R_as_A, R_as_B);
    return show(result);
  }

  const unknown = missing[0];

  // ---------- FORMULAS ----------
  const molesAcidInitial = (vA / 1000) * cA;
  const molesBase = (vB / 1000) * cB;
  const acidEquivalent = molesBase * (R_ab_A / R_ab_B);
  const molesAcidReacted = molesAcidInitial - acidEquivalent;
  const molesSubstance = molesAcidReacted * (R_as_B / R_as_A);

  // AUTO COMPUTE UNKNOWN
  let solved;

  switch (unknown) {

    case "mass":
      solved = molesSubstance * 1; // molar mass not needed here
      solved = `Missing MASS = moles × molar mass<br>Cannot compute because molar mass is also unknown.`;
      break;

    case "vA":
      const neededAcid = molesAcidReacted + acidEquivalent;
      solved = neededAcid / cA * 1000;
      break;

    case "cA":
      solved = (molesAcidReacted + acidEquivalent) / (vA / 1000);
      break;

    case "vB":
      const neededBase = (molesAcidInitial - molesAcidReacted) / (R_ab_A / R_ab_B);
      solved = neededBase / cB * 1000;
      break;

    case "cB":
      const neededBaseMoles = (molesAcidInitial - molesAcidReacted) / (R_ab_A / R_ab_B);
      solved = neededBaseMoles / (vB / 1000);
      break;
  }

  show(`<b>Unknown solved (${unknown}):</b> ${solved}`);
}


/*** Helpers ***/
function get(id) {
  const value = document.getElementById(id).value;
  return value === "" ? null : parseFloat(value);
}

function show(msg) {
  document.getElementById("auto_back_result").innerHTML = msg;
}

function calculateAll(mass, vA, cA, vB, cB, RA, RB, RS_A, RS_B) {
  return `
    All values present — calculation done.<br>
    <b>Molar mass:</b> ${mass / (((vA/1000)*cA - (vB/1000)*cB*(RA/RB))*(RS_B/RS_A))}
  `;
}





function calculateRedox() {
  const vOx = parseFloat(document.getElementById('redoxVolOx').value) / 1000;
  const cOx = parseFloat(document.getElementById('redoxConcOx').value);
  const vRed = parseFloat(document.getElementById('redoxVolRed').value) / 1000;
  const cRed = parseFloat(document.getElementById('redoxConcRed').value);
  const rOx = parseFloat(document.getElementById('redoxRatioOx').value);
  const rRed = parseFloat(document.getElementById('redoxRatioRed').value);

  const steps = [];

  // Determine which concentration is missing
  let missing = null;
  if (!cOx && cRed) missing = 'oxidant';
  else if (!cRed && cOx) missing = 'reductant';
  else if (!cOx && !cRed) {
    document.getElementById('redoxResult').innerHTML = "<div class='step'>Error: Enter at least one concentration!</div>";
    return;
  }

  steps.push(`<div class='step formula'>Step 1: Use mole ratio Oxidant:Reductant = ${rOx}:${rRed}</div>`);

  if (missing === 'oxidant') {
    // Moles of reductant
    const molesRed = vRed * cRed;
    steps.push(`<div class='step'>Moles of reductant = ${format(vRed)} × ${format(cRed)} = ${format(molesRed)} mol</div>`);
    // Moles of oxidant
    const molesOx = molesRed * (rOx / rRed);
    steps.push(`<div class='step formula'>Moles of oxidant = moles of reductant × (${rOx}/${rRed})</div>`);
    steps.push(`<div class='step'>Moles of oxidant = ${format(molesRed)} × (${rOx}/${rRed}) = ${format(molesOx)} mol</div>`);
    // Concentration of oxidant
    const concOx = molesOx / vOx;
    steps.push(`<div class='step formula'>Concentration of oxidant = moles / volume</div>`);
    steps.push(`<div class='step'>${format(molesOx)} ÷ ${format(vOx)} = ${format(concOx)} mol/dm³</div>`);
  } else {
    // Moles of oxidant
    const molesOx = vOx * cOx;
    steps.push(`<div class='step'>Moles of oxidant = ${format(vOx)} × ${format(cOx)} = ${format(molesOx)} mol</div>`);
    // Moles of reductant
    const molesRed = molesOx * (rRed / rOx);
    steps.push(`<div class='step formula'>Moles of reductant = moles of oxidant × (${rRed}/${rOx})</div>`);
    steps.push(`<div class='step'>Moles of reductant = ${format(molesOx)} × (${rRed}/${rOx}) = ${format(molesRed)} mol</div>`);
    // Concentration of reductant
    const concRed = molesRed / vRed;
    steps.push(`<div class='step formula'>Concentration of reductant = moles / volume</div>`);
    steps.push(`<div class='step'>${format(molesRed)} ÷ ${format(vRed)} = ${format(concRed)} mol/dm³</div>`);
  }

  document.getElementById('redoxResult').innerHTML = steps.join('');
}



</script>

</body>
</html>




