<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Smart Tutor: Save + Repeat + Download</title>
  <script src="https://unpkg.com/mathlive"></script>
  <link rel="stylesheet" href="https://unpkg.com/mathlive/dist/mathlive.core.css" />
  <style>
    html, body {
      margin: 0;
      padding: 0;
      height: 100%;
      font-family: 'Segoe UI', sans-serif;
      background: #eef1f5;
    }
    #app {
      display: flex;
      flex-direction: column;
      height: 100%;
    }
    #toolbar {
      padding: 15px;
      background: #1976d2;
      color: white;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    #toolbar button {
      background: white;
      color: #1976d2;
      padding: 10px 16px;
      border: none;
      border-radius: 5px;
      font-size: 16px;
      cursor: pointer;
    }
    #editor {
      flex: 1;
      padding: 30px;
      font-size: 1.6em;
      background: #fff;
      overflow-y: auto;
      outline: none;
      white-space: pre-wrap;
      cursor: text;
    }
    math-field {
      font-size: 1.4em;
      margin: 0 4px;
    }
    #status {
      padding: 10px;
      background: #388e3c;
      color: white;
      font-weight: bold;
      text-align: center;
    }
    .question { color: #333; margin-bottom: 20px; font-weight: bold; }
    .solution { color: #2e7d32; font-weight: normal; }
    .hand-writing {
      cursor: url('https://cur.cursors-4u.net/people/peo-2/peo129.cur'), auto !important;
    }
  </style>
</head>
<body>

<div id="app">
  <div id="toolbar">
    <button onclick="startTutor()">‚ñ∂Ô∏è Start Tutor</button>
    <button onclick="pauseLesson()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeLesson()">‚ñ∂Ô∏è Resume</button>
    <button onclick="repeatLesson()">üîÅ Repeat Lesson</button>
    <button onclick="repeatQuestion()">üîÅ Repeat Question</button>
    <button onclick="skipLesson()">‚è≠Ô∏è Skip</button>
    <button onclick="downloadAll()">‚¨áÔ∏è Download All</button>
  </div>

  <div id="editor" contenteditable="true">
    <p>Click "Start Tutor" to begin.</p>
  </div>

  <div id="status">‚è≥ Ready when you are!</div>
</div>

<script>
  const lessonsArray = [
   `Lesson 1: Study Smarter with Elimu Connect

The Elimu Connect app is now on Play Store. Visit our website at https://elimuconnect.github.io/ELIMU-CONNECT-/elimu

At Elimu Connect, students access powerful learning tools:

- Live Lessons start at just Ksh 200 / $1.6 per hour.
- Includes a FREE AI-Powered Live Tutor available anytime.
- Connect instantly with nearby tutors for academic help.
- Access over 2,000 video lessons and 5,000 quizzes.
- Take weekly live tests and earn certificates.
- Practice with 30,000 past papers, 1,000 Q&A pairs, and 200 eBooks.
- Use the Digital Notebook, Scientific Calculator, and Personal Study Timetable Maker for daily learning efficiency.`,

  `Lesson 2: Fun + Smart = Elimu Connect Learning

The Elimu Connect app is now on Play Store. Visit our website at https://elimuconnect.github.io/ELIMU-CONNECT-/elimu

Elimu Connect turns revision into fun:

- Play 3 math games and 3 language games while mastering core concepts.
- Engage in student forums and get peer help instantly.
- Access the Digital Dictionary, Kamusi, and figurative language tools:
  Similes, Metaphors, Misemo, Nahau, and Methali.
- Use interactive tools for Math, Chemistry, and Physics:
  Formulas, Mole Concept, Area/Volume/Trigonometry tools, Chemical Equations, Organic Chemistry, and more.
- Visualize topics using Human, Fish, and Plant Anatomy Tools and the Digital Periodic Table.`,

  `Lesson 3: Elimu Connect for Tutors & Schools

The Elimu Connect app is now on Play Store. Visit our website at https://elimuconnect.github.io/ELIMU-CONNECT-/elimu

For Tutors:
- Get listed and connect with students for online or in-person tutoring.
- Join Evening School-Based Programs and teach on your schedule.
- Upload notes, exams, and access lesson plans and schemes of work.
- Participate in TSC swaps, teachers‚Äô forums, and access global job links.

For Schools:
- Get academic charts, digital tools, and ICT integration support.
- Run evening tuition programs and launch STEMLA (STEM + Languages) clubs.
- Partner on tree planting and CSR projects.
- Use performance tracking tools and access bulk eLearning subscriptions.
- We also develop websites for schools and institutions.`
];

  const questionsArray = [
    {
      question: "Q1: Solve for x: 2x + 6 = 14",
      solution: "Step 1: Subtract 6 ‚Üí 2x = 8\nStep 2: Divide by 2 ‚Üí x = 4"
    },
    {
      question: "Q2: Simplify (x + 3)(x - 1)",
      solution: "Step 1: Expand ‚Üí x¬≤ - x + 3x - 3\nStep 2: Combine like terms ‚Üí x¬≤ + 2x - 3"
    }
  ];

  const editor = document.getElementById("editor");
  const status = document.getElementById("status");

  let tutorStarted = false;
  let paused = false;
  let typingTimer = null;
  let waitTimer = null;
  let inLessonMode = true;
  let currentLesson = 0;
  let currentQuestion = 0;
  const fullTranscript = [];

  function getVoice() {
    const voices = speechSynthesis.getVoices();
    const preferred = ["Google UK English Male", "en-GB", "en-IN", "en-KE"];
    return voices.find(v => preferred.includes(v.name) || preferred.includes(v.lang)) || voices[0];
  }

  function speak(text, onEnd) {
    speechSynthesis.cancel();
    const utter = new SpeechSynthesisUtterance(text);
    utter.voice = getVoice();
    utter.rate = 0.88;
    utter.onend = () => onEnd && onEnd();
    speechSynthesis.speak(utter);
  }

  function typeSolution(text, callback) {
    const solutionDiv = document.createElement("div");
    solutionDiv.className = "solution";
    editor.appendChild(solutionDiv);
    editor.classList.add("hand-writing");

    let i = 0;
    typingTimer = setInterval(() => {
      if (paused) return;
      if (i >= text.length) {
        clearInterval(typingTimer);
        editor.classList.remove("hand-writing");
        callback && callback();
        return;
      }
      solutionDiv.textContent += text[i++];
    }, 80);
  }

  function showLesson(index) {
    if (index >= lessonsArray.length) {
      inLessonMode = false;
      showQuestion(currentQuestion);
      return;
    }

    const text = lessonsArray[index];
    editor.innerHTML = `<div class="question">${text}</div>`;
    status.textContent = `üìñ Lesson ${index + 1}: Reading...`;
    fullTranscript.push(`Lesson ${index + 1}:\n${text}\n`);

    speak(text, () => {
      currentLesson++;
      setTimeout(() => showLesson(currentLesson), 4000);
    });
  }

  function showQuestion(index) {
    if (index >= questionsArray.length) {
      editor.innerHTML = "‚úÖ All lessons and questions completed.";
      status.textContent = "‚úÖ Done.";
      return;
    }

    const q = questionsArray[index];
    editor.innerHTML = `<div class="question">${q.question}</div>`;
    status.textContent = `üîä Reading Question ${index + 1}...`;
    fullTranscript.push(`\n${q.question}\n`);

    speak(q.question, () => {
      status.textContent = `‚åõ Writing solution in 10 seconds...`;
      waitTimer = setTimeout(() => {
        if (!paused) {
          status.textContent = `‚úçÔ∏è Writing Solution...`;
          typeSolution(q.solution, () => {
            status.textContent = `üîä Reading Solution...`;
            fullTranscript.push(`${q.solution}\n`);
            speak(q.solution, () => {
              status.textContent = `‚úÖ Done with Question ${index + 1}.`;
              currentQuestion++;
              setTimeout(() => showQuestion(currentQuestion), 5000);
            });
          });
        }
      }, 10000);
    });
  }

  function startTutor() {
    if (tutorStarted) return;
    tutorStarted = true;
    status.textContent = "üü¢ Tutor is starting...";
    showLesson(currentLesson);
  }

  function pauseLesson() {
    paused = true;
    clearTimeout(waitTimer);
    clearInterval(typingTimer);
    speechSynthesis.cancel();
    editor.classList.remove("hand-writing");
    status.textContent = "‚è∏Ô∏è Paused.";
  }

  function resumeLesson() {
    if (!paused) return;
    paused = false;
    status.textContent = '‚èØÔ∏è Resumed lesson';
    speak(editor.textContent);
  }

  function repeatLesson() {
    if (currentLesson > 0) {
      currentLesson--;
      showLesson(currentLesson);
    }
  }

  function repeatQuestion() {
    if (!inLessonMode && currentQuestion > 0) {
      currentQuestion--;
      showQuestion(currentQuestion);
    }
  }

  function skipLesson() {
    if (inLessonMode) {
      currentLesson++;
      showLesson(currentLesson);
    } else {
      currentQuestion++;
      showQuestion(currentQuestion);
    }
  }

  function downloadAll() {
    const blob = new Blob([fullTranscript.join("\n")], { type: 'text/plain' });
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "tutor_transcript.txt";
    a.click();
  }
</script>
</body>
</html>
