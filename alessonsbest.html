<script>
/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCAiOSHmURDyAAYm5EmoomLkZ_Aud7iXIQ",
  authDomain: "cbc-general.firebaseapp.com",
  databaseURL: "https://cbc-general-default-rtdb.firebaseio.com",
  projectId: "cbc-general",
  storageBucket: "cbc-general.firebasestorage.app",
  messagingSenderId: "764732839741",
  appId: "1:764732839741:web:ab829af54839de91359754"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.database();
/* -------------------------------------- */

const editor = document.getElementById("editor");
const status = document.getElementById("status");
const loginBtn = document.getElementById("loginBtn");

let user=null;
loginBtn.onclick=()=>{
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
      .then(res=>{
        user=res.user;
        status.textContent=`üëã Hi ${user.displayName}`;
      })
      .catch(e=>alert(e.message));
};
auth.onAuthStateChanged(u=>{
  user=u;
  if(u){status.textContent=`üëã Hi ${u.displayName}`;}
});

/* ---------- DAILY LESSON HTML ---------- */
/*  Mon‚ÄìSat lessons, each entry is a full HTML string  */
const lessonsArray = {
  "Mon":[
`<span style="color: purple; font-size: 1.2em;"><b>Install Elimu Connect App</b></span>
 from Play Store or visit 
<a href="https://elimuconnect.github.io/ELIMU-CONNECT-/elimu" target="_blank">
https://elimuconnect.github.io/ELIMU-CONNECT-/elimu</a><br><br>

<span style="color:purple;"><b>Lesson 1: Introduction to Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

<b>Integers</b> are the set of whole numbers and their negatives, including zero.<br><br>

<b>Examples:</b>
<ul>
  <li>Positive integers: 1, 2, 3, ‚Ä¶</li>
  <li>Negative integers: -1, -2, -3, ‚Ä¶</li>
  <li>Zero: 0 (neutral, not positive or negative)</li>
</ul><br>

On a number line, integers extend infinitely in both directions.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What are integers? Give three examples.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Integers are whole numbers and their negatives including zero.<br>
Examples: -3, 0, 5.<br>`
  ],

  "Tue":[
`<span style="color:purple;"><b>Lesson 2: Representing Integers on a Number Line</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

A <b>number line</b> is used to represent integers.<br>
- Numbers to the right of zero are positive.<br>
- Numbers to the left of zero are negative.<br><br>

<b>Example:</b>  
‚Ä¶ -4, -3, -2, -1, 0, 1, 2, 3, 4 ‚Ä¶<br><br>

Zero separates positive and negative integers.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
How are positive and negative integers represented on a number line?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Positive integers are placed to the right of zero, while negative integers are placed to the left of zero.<br>`
  ],

  "Wed":[
`<span style="color:purple;"><b>Lesson 3: Addition of Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Rules for addition:
<ul>
  <li>If the signs are the same ‚Üí Add the numbers and keep the sign.</li>
  <li>If the signs are different ‚Üí Subtract the smaller number from the larger and take the sign of the larger number.</li>
</ul><br>

<b>Examples:</b><br>
(+3) + (+4) = +7<br>
(-5) + (-2) = -7<br>
(+6) + (-4) = +2<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Find the sum: (a) -7 + (-5), (b) 9 + (-3)<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
(a) -12<br>
(b) 6<br>`
  ],

  "Thu":[
`<span style="color:purple;"><b>Lesson 4: Subtraction of Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Subtraction of integers can be changed into addition:
<b>a - b = a + (-b)</b><br><br>

<b>Examples:</b><br>
7 - 3 = 7 + (-3) = 4<br>
(-5) - 4 = (-5) + (-4) = -9<br>
(-6) - (-2) = (-6) + 2 = -4<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Simplify: (a) -8 - 3, (b) -10 - (-6)<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
(a) -11<br>
(b) -4<br>`
  ],

  "Fri":[
`<span style="color:purple;"><b>Lesson 5: Multiplication of Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Rules for multiplication:
<ul>
  <li>Positive √ó Positive = Positive</li>
  <li>Negative √ó Negative = Positive</li>
  <li>Positive √ó Negative = Negative</li>
</ul><br>

<b>Examples:</b><br>
4 √ó 3 = 12<br>
(-5) √ó (-2) = 10<br>
(-6) √ó 3 = -18<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Evaluate: (a) -7 √ó 4, (b) -8 √ó -5<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
(a) -28<br>
(b) 40<br>`
  ],

  "Sat":[
`<span style="color:purple;"><b>Lesson 6: Division of Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Rules for division:
<ul>
  <li>Positive √∑ Positive = Positive</li>
  <li>Negative √∑ Negative = Positive</li>
  <li>Positive √∑ Negative = Negative</li>
</ul><br>

<b>Examples:</b><br>
12 √∑ 3 = 4<br>
(-20) √∑ (-5) = 4<br>
(-15) √∑ 3 = -5<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Simplify: (a) -24 √∑ 6, (b) -30 √∑ -5<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
(a) -4<br>
(b) 6<br>`
  ]
};

/* ---------- Voice ---------- */
let selectedVoice=null, utter=null;
function getVoice(){
  const v=speechSynthesis.getVoices();
  return v.find(x=>x.lang.toLowerCase().startsWith("en-ke"))||
         v.find(x=>x.lang.toLowerCase().startsWith("en-gb"))||
         v[0];
}
function speak(html){
  const tmp=document.createElement("div");
  tmp.innerHTML=html;
  speechSynthesis.cancel();
  utter=new SpeechSynthesisUtterance(tmp.textContent);
  utter.voice=selectedVoice;
  utter.rate=0.8;
  speechSynthesis.speak(utter);
}

/* ---------- Start Tutor ---------- */
function startTutor(){
  if(!user){alert("‚ö†Ô∏è Please login with Google first.");return;}

  const days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  const nowUTC=new Date();
  const kenyaTime=new Date(nowUTC.getTime()+(3*60+nowUTC.getTimezoneOffset())*60000);
  const dayName=days[kenyaTime.getDay()];
  const hour=kenyaTime.getHours();

  if(hour<16 || hour>=23){
    editor.innerHTML=`<div class='card'><h2>‚è≥ Lessons open 4 PM ‚Äì 11 PM Kenya time.</h2></div>`;
    status.textContent="‚õî Outside lesson hours";
    return;
  }

  const todayLessons = lessonsArray[dayName];
  if(!todayLessons){
    editor.innerHTML=`<div class='card'><h2>üéâ No lessons scheduled for ${dayName}</h2></div>`;
    status.textContent="No lesson today";
    return;
  }

  // Load voice then show all lessons for today
  const check=setInterval(()=>{
    if(speechSynthesis.getVoices().length){
      clearInterval(check);
      selectedVoice=getVoice();
      showLessons(todayLessons);
    }
  },200);
  status.textContent=`üü¢ Showing lessons for ${dayName}`;
}

function showLessons(list){
  // Join all HTML strings into one scrollable card
  editor.innerHTML=`<div class="card">${list.join("<hr>")}</div>`;
  speak(list.join(" "));
}

function pauseTutor(){speechSynthesis.pause();status.textContent="‚è∏Ô∏è Paused";}
function resumeTutor(){speechSynthesis.resume();status.textContent="‚ñ∂Ô∏è Resumed";}
function contactWhatsApp(){window.open("https://wa.me/254769255782","_blank");}

/* Rating */
document.querySelectorAll(".rating span").forEach(star=>{
  star.addEventListener("click",()=>{
    const val=star.dataset.v;
    document.querySelectorAll(".rating span")
      .forEach(s=>s.classList.toggle("active",s.dataset.v<=val));
    if(user){
      db.ref("ratings/"+user.uid)
        .set({name:user.displayName,rating:val,timestamp:Date.now()});
      alert(`Thanks! You rated ${val}‚≠ê`);
    }else alert("Login first to save rating.");
  });
});
</script>
