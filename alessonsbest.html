<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Tutor ‚Äì Daily Live Lessons</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { box-sizing: border-box; }
html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right,#e0f7fa,#fce4ec);
}
#app { display: flex; flex-direction: column; height: 100vh; }
#toolbar {
  padding: 15px;
  background: #1976d2;
  color: white;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}
#toolbar button {
  background: white;
  color: #1976d2;
  padding: 12px 20px;
  border: none;
  border-radius: 30px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s ease;
}
#toolbar button:hover { background: #f0f0f0; }
#editor {
  flex: 1;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}
/* ‚úÖ NEW CARD STYLE */
.card {
  max-width: 90vw;
  width: 100%;
  margin: 20px auto;
  padding: 40px;
  background: white;
  border-radius: 25px;
  border: 2px solid #ccc; /* Added border for prominence */
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  font-size: 1.8em;
  line-height: 2;
  font-weight: bold;
  animation: fadeIn 1s ease;
  overflow-wrap: break-word;
  word-break: break-word;
  color: #1a237e;
  box-sizing: border-box;
  transition: all 0.3s ease-in-out; /* Smooth hover or layout changes */
}

/* Headings inside cards */
.card h2 {
  margin-top: 0;
  font-size: 2em;
  font-weight: bold;
}

/* Optional manual title colors */
.card h2.red    { color: #d81b60; }
.card h2.green  { color: #2e7d32; }
.card h2.blue   { color: #1565c0; }
.card h2.orange { color: #ef6c00; }
.card h2.purple { color: #6a1b9a; }

/* Automatic color cycling for h2s inside cards */
.card h2:nth-child(5n+1) { color: #d81b60; }
.card h2:nth-child(5n+2) { color: #2e7d32; }
.card h2:nth-child(5n+3) { color: #1565c0; }
.card h2:nth-child(5n+4) { color: #ef6c00; }
.card h2:nth-child(5n+5) { color: #6a1b9a; }

.card pre {
  white-space: pre-wrap;
  overflow-wrap: break-word;
  word-break: break-word;
  font-size: 1.6em;
  line-height: 2;
  font-weight: bold;
  color: #1a237e;
}

#status {
  padding: 15px;
  background: #388e3c;
  color: white;
  font-weight: bold;
  text-align: center;
  font-size: 16px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ‚úÖ Mobile adjustments */
@media (max-width: 600px) {
  #toolbar {
    flex-direction: column;
    gap: 8px;
    padding: 10px;
  }

  #toolbar button {
    width: 100%;
    font-size: 16px;
    padding: 10px;
  }

  .card {
    padding: 20px;
    font-size: 1.2em;
  }

  .card h2 {
    font-size: 1.4em;
  }

  .card pre {
    font-size: 1.15em;
  }

  #status {
    font-size: 15px;
    padding: 10px;
  }
}

/* Extra formatting helpers for lesson text */
.lesson-title {
  color: #d32f2f; /* Deep red */
  font-size: 1.2em;
  display: block;
  margin: 10px 0;
}
.subtopic {
  color: #1976d2; /* Blue */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.question {
  color: #f57c00; /* Orange */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.answer {
  color: #388e3c; /* Green */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.bullet {
  color: #6a1b9a; /* Purple dot */
  margin-right: 8px;
}
.point {
  color: #1a237e;
  display: block;
  margin-left: 20px;
}


.rating {
  margin-top: 20px;
  font-size: 2em;
  color: #ccc;            /* Default gray */
  display: inline-block;
  cursor: pointer;
  user-select: none;
}
.rating span {
  transition: color 0.3s;
}
.rating span.hover,
.rating span.selected {
  color: gold;            /* Highlighted star */
}


  .timetable {
  margin-top: 12px;
  background: #f9fbff;
  padding: 8px;
  border-radius: 8px;
  box-shadow: 0 1px 3px rgba(0,0,0,0.05);
}

.timetable h3 {
  margin: 0 0 6px;
  color: #1976d2;
  font-size: 1em;
}

.timetable table {
  width: 100%;
  border-collapse: collapse;
  font-size: 0.85em; /* smaller font */
}

.timetable th {
  background: #1976d2;
  color: white;
  padding: 4px 6px; /* reduced padding */
  text-align: left;
  border: 1px solid #ccc;
}

.timetable td {
  padding: 4px 6px; /* reduced padding */
  border: 1px solid #ccc;
}

.timetable tr:nth-child(even) {
  background: #f1f6fb;
}

</style>
</head>
<body>
<div id="app">

  <div id="toolbar">
    <button id="loginBtn">üîë Google Login</button>
    <button onclick="startTutor()">‚ñ∂Ô∏è Start Tutor</button>
    <button onclick="pauseTutor()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeTutor()">‚ñ∂Ô∏è Resume</button>
    <button onclick="prevLesson()">‚¨ÖÔ∏è Back</button>
    <button onclick="nextLesson()">‚û°Ô∏è Next</button>
    <button onclick="contactWhatsApp()">üí¨ Customer Care</button>
  </div>

<div id="editor">

  <!-- Phone Number Form -->
  <div id="phoneForm" style="display:none; text-align:center; padding:20px; margin-bottom:20px; 
       border:1px solid #ccc; border-radius:10px; background:#f9f9f9;">
    <h2>üì± Enter Your Phone Number</h2>
    <p id="studentName"></p>
    <input type="text" id="phoneInput" placeholder="e.g. 07xx xxx xxx" 
           style="padding:10px; font-size:1em; width:80%; max-width:300px; border:1px solid #aaa; border-radius:6px;">
    <br><br>
    <button onclick="savePhoneNumber()" 
            style="padding:10px 20px; font-size:1em; border:none; border-radius:8px; background:#1976d2; color:white; cursor:pointer;">
      Save & Unlock Lessons
    </button>
  </div>

  <!-- Main Tutor Card -->
  <div class="card">
    <!-- Rating message container -->
    <div id="ratingMessage" style="display:none; color:#388e3c; font-weight:bold; margin-bottom:10px; 
         opacity:0; transform:translateY(-10px); transition: all 0.5s ease;"></div>
<h2>Welcome to Smart Tutor</h2>
<p>Login with Google to access live CBC lessons (Mon‚ÄìSat) with voice narration.</p>

<!-- Timetable -->
<div class="timetable">
  <h3>üìÖ Weekly Timetable (Kenya time)</h3>
  <table>
    <thead>
      <tr>
        <th>Day</th>
        <th>Subject</th>
        <th>Time</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="3">Mon ‚Äì Fri</td>
        <td>Math</td>
        <td>5:30 PM ‚Äì 7:00 PM</td>
      </tr>
      <tr>
        <td>Integrated Science</td>
        <td>7:30 PM ‚Äì 8:30 PM</td>
      </tr>
      <tr>
        <td>English</td>
        <td>9:00 PM ‚Äì 10:00 PM</td>
      </tr>

      <tr>
        <td rowspan="3">Saturday</td>
        <td>Math</td>
        <td>8:00 AM ‚Äì 10:00 AM</td>
      </tr>
      <tr>
        <td>Integrated Science</td>
        <td>10:30 AM ‚Äì 12:00 PM</td>
      </tr>
      <tr>
        <td>English</td>
        <td>2:00 PM ‚Äì 3:30 PM</td>
      </tr>

      <tr>
        <td>Sunday</td>
        <td colspan="2">No lessons scheduled</td>
      </tr>
    </tbody>
  </table>
</div>



    <div class="rating" id="ratingStars">
      <p style="font-size:0.6em;margin:5px 0;">Rate this Tutor:</p>
      <span data-v="1">‚òÖ</span>
      <span data-v="2">‚òÖ</span>
      <span data-v="3">‚òÖ</span>
      <span data-v="4">‚òÖ</span>
      <span data-v="5">‚òÖ</span>
    </div>

    <p id="ratingValue" style="font-size:0.6em;color:#1976d2;margin-top:6px;">
      Average Rating: <span id="avgRating">‚Äì</span> ‚òÖ
    </p>
  </div>
</div>

<div id="lessonContainer"></div>
<div id="status">‚è≥ Ready‚Ä¶</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>

<script>
/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCAiOSHmURDyAAYm5EmoomLkZ_Aud7iXIQ",
  authDomain: "cbc-general.firebaseapp.com",
  databaseURL: "https://cbc-general-default-rtdb.firebaseio.com",
  projectId: "cbc-general",
  storageBucket: "cbc-general.firebasestorage.app",
  messagingSenderId: "764732839741",
  appId: "1:764732839741:web:ab829af54839de91359754"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
/* -------------------------------------- */

const editor = document.getElementById("editor");
const status = document.getElementById("status");
const loginBtn = document.getElementById("loginBtn");

let user = null;

loginBtn.onclick = () => {
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
    .then(res => {
      user = res.user;
      status.textContent = `üëã Hi ${user.displayName}`;

      // After login ‚Üí check if phone exists
      db.ref("students/" + user.uid).once("value").then(snap => {
        if (!snap.exists() || !snap.val().phone) {
          // Show phone number form
         document.getElementById("studentName").textContent =
  `Welcome ${user.displayName}, please enter your phone number:`;
document.getElementById("phoneForm").style.display = "block";

// Hide tutor card instead of deleting everything
document.querySelector(".card").style.display = "none";

        }
      });
    })
    .catch(e => alert(e.message));
};

auth.onAuthStateChanged(u => {
  user = u;
  if (u) {
    status.textContent = `üëã Hi ${u.displayName}`;

    // Also check if phone is saved on reload
    db.ref("students/" + u.uid).once("value").then(snap => {
      if (!snap.exists() || !snap.val().phone) {
        document.getElementById("studentName").textContent =
  `Welcome ${user.displayName}, please enter your phone number:`;
document.getElementById("phoneForm").style.display = "block";

// Hide tutor card instead of deleting everything
document.querySelector(".card").style.display = "none";

      }
    });
  }
});

/* ---------- LESSON TIMETABLE ---------- */
const timetable = {
  Mon: [
    {subject: "Math", start: "17:30", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Tue: [
    {subject: "Math", start: "17:30", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Wed: [
    {subject: "Math", start: "17:30", end: "19:00"},
    {subject: "Science", start: "17:50", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Thu: [
    {subject: "Math", start: "9:00", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Fri: [
    {subject: "Math", start: "17:30", end: "19:00"},
    {subject: "Science", start: "19:30", end: "20:30"},
    {subject: "English", start: "21:00", end: "22:00"}
  ],
  Sat: [
    {subject: "Math", start: "08:00", end: "10:00"},
    {subject: "Science", start: "10:30", end: "12:00"},
    {subject: "English", start: "14:00", end: "15:30"}
  ]
};

/* ---------- HELPER: Check if current time is in a slot ---------- */
function inTimeRange(start, end, now){
  const [sH, sM] = start.split(":").map(Number);
  const [eH, eM] = end.split(":").map(Number);
  const startTime = new Date(now); startTime.setHours(sH, sM, 0, 0);
  const endTime = new Date(now); endTime.setHours(eH, eM, 0, 0);
  return now >= startTime && now <= endTime;
}

/* ---------- LESSONS ---------- */
let lessonsArray = {
  Mon: { Math: ["<h2>Math Lesson 1</h2><p>Surds & Indices practice‚Ä¶</p>"], Science: [`<span style="color:purple;"><b>Lesson 1: Introduction to Rusting</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Rusting is a chemical process that affects iron and its alloys when exposed to moisture (water) and oxygen. It produces a reddish-brown flaky substance called rust. Rusting weakens iron objects, making them brittle and reducing their strength.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What is rusting and which metal is mainly affected?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Rusting is a chemical process that forms a reddish-brown flaky substance on iron when exposed to water and oxygen. Iron is mainly affected.<br>
`,

`<span style="color:purple;"><b>Lesson 2: Conditions for Rusting</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Two main conditions are necessary for rusting to occur: 
1. Presence of water (or moisture)
2. Presence of oxygen (air)<br><br>

Rusting is an example of corrosion, which gradually destroys metals.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What are the two main conditions needed for rusting to take place?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Presence of water (moisture) and presence of oxygen (air).<br>
`,

`<span style="color:purple;"><b>Lesson 3: Effects of Rusting</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Rusting causes serious damage to metal structures. It makes iron objects weak, brittle, and reduces their strength. Structures like bridges, roofs, and vehicles can collapse or fail if rusting is not prevented.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
How does rusting affect iron objects and structures?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Rusting weakens iron, makes it brittle, and can lead to the collapse or failure of structures like bridges, roofs, and vehicles.<br>
`,

`<span style="color:purple;"><b>Lesson 4: Painting to Prevent Rust</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Painting iron surfaces creates a protective layer that prevents water and oxygen from coming into contact with the metal. This simple method is commonly used to protect gates, doors, and machinery from rust.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
How does painting help in preventing rust?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Painting forms a protective layer that stops water and oxygen from reaching the metal, preventing rust.<br>
`,

`<span style="color:purple;"><b>Lesson 5: Greasing, Galvanizing, and Electroplating</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

- Greasing or oiling metal surfaces acts as a barrier against air and water.<br>
- Galvanizing coats iron with zinc, which corrodes instead of iron.<br>
- Electroplating uses electricity to coat iron with another metal, protecting it from rust.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Name three methods of preventing rust and briefly explain them.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Greasing/oiling: blocks air and water. Galvanizing: coating with zinc, which corrodes first. Electroplating: coating with another metal using electricity.<br>
`,

`<span style="color:purple;"><b>Lesson 6: Stainless Steel</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Stainless steel contains chromium, which resists rusting. It is strong, durable, and commonly used in kitchen utensils, surgical instruments, and water tanks.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Why is stainless steel used instead of regular iron?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Stainless steel contains chromium, which prevents rusting, making it strong, durable, and long-lasting.<br>
`,

`<span style="color:purple;"><b>Lesson 7: Importance of Preventing Rust</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Preventing rust is important to maintain the strength and safety of metal structures. Proper prevention ensures long-lasting bridges, buildings, vehicles, and machinery, avoiding costly repairs and accidents.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Why is it necessary to prevent rust?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Preventing rust keeps metal strong and safe, ensures durability of structures, and avoids accidents and costly repairs.<br>
`
], English: ["<h2>English Lesson 1</h2><p>Sentence Analysis‚Ä¶</p>"] },
  Tue: { Math: ["<h2>Math Lesson 1</h2><p>Quadratic Equations‚Ä¶</p>"], Science: [`<span style="color:purple;"><b>Lesson 1: Introduction to Uses of Metals and Alloys</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Metals and alloys play a crucial role in modern life and industry. They are used in construction, technology, transportation, and daily life. Their unique properties like strength, durability, conductivity, and resistance to corrosion make them highly valuable.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Why are metals and alloys important in modern life?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Metals and alloys are important because of their strength, durability, conductivity, and resistance to corrosion, which make them essential in construction, technology, transportation, and daily life.<br>
`,

`<span style="color:purple;"><b>Lesson 2: Iron and Steel</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Iron and steel are the most commonly used construction materials. They are found in bridges, buildings, vehicles, and tools due to their high strength and durability. Steel is often preferred over pure iron because it is stronger and more resistant to wear and tear.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Where are iron and steel commonly used and why?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Iron and steel are used in bridges, buildings, vehicles, and tools because they are strong and durable.<br>
`,

`<span style="color:purple;"><b>Lesson 3: Aluminum</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Aluminum is lightweight, resists rust, and is easy to shape. It is used to make cooking utensils, aircraft bodies, soda cans, and packaging foils. Its low density and corrosion resistance make it ideal for applications where weight and durability matter.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
List some uses of aluminum and explain why it is preferred.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Aluminum is used in cooking utensils, aircraft bodies, soda cans, and packaging foils because it is lightweight and resistant to rust.<br>
`,

`<span style="color:purple;"><b>Lesson 4: Copper</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Copper is an excellent conductor of electricity, making it widely used in electrical wiring and components. It is also used to make plumbing pipes, cookware, and other household items due to its durability and resistance to corrosion.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What are the main uses of copper?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Copper is used in electric wiring, electrical components, plumbing pipes, and cookware because it conducts electricity well and is durable.<br>
`,

`<span style="color:purple;"><b>Lesson 5: Brass</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Brass is an alloy of copper and zinc. It is attractive, corrosion-resistant, and easy to shape. Brass is commonly used to make taps, door handles, musical instruments, and decorative ornaments.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Give examples of how brass is used and why.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Brass is used in taps, door handles, musical instruments, and ornaments because it is attractive, corrosion-resistant, and easy to shape.<br>
`,

`<span style="color:purple;"><b>Lesson 6: Bronze</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Bronze, an alloy of copper and tin, is strong, durable, and resistant to corrosion. It is widely used to manufacture statues, sculptures, coins, and medals due to its strength and aesthetic appeal.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What are the uses of bronze?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Bronze is used to make statues, sculptures, coins, and medals because it is strong, durable, and corrosion-resistant.<br>
`,

`<span style="color:purple;"><b>Lesson 7: Stainless Steel</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Stainless steel is strong, rust-proof, and hygienic. It is ideal for kitchenware, surgical tools, water tanks, and food processing equipment. Its resistance to corrosion and durability makes it essential in both household and industrial applications.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Why is stainless steel important and what are its main uses?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Stainless steel is important because it is strong, rust-proof, and hygienic. It is used in kitchenware, surgical tools, water tanks, and food processing equipment.<br>
`
], English: ["<h2>English Lesson 1</h2><p>Comprehension‚Ä¶</p>"] },
  Wed: { Math: [`<span style="color: purple; font-size: 1.2em;"><b>Install Elimu Connect App</b></span> from Play Store or visit 
<a href="https://elimuconnect.github.io/ELIMU-CONNECT-/elimu" target="_blank">https://elimuconnect.github.io/ELIMU-CONNECT-/elimu</a> 
for CBC academic & CODING lessons<br>

<span style="color:purple;"><b>Lesson 1: Introduction to Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

<b>Integers</b> are the set of whole numbers and their negatives, including zero.<br><br>

<b>Examples:</b><br>
<ul>
  <li>Positive integers: 1, 2, 3, ‚Ä¶</li>
  <li>Negative integers: -1, -2, -3, ‚Ä¶</li>
  <li>Zero: 0 (neutral, not positive or negative)</li>
</ul><br>

On a number line, integers extend infinitely in both directions.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What are integers? Give three examples.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Integers are whole numbers and their negatives including zero.<br>
Examples: -3, 0, 5.<br>
`,

`<span style="color:purple;"><b>Lesson 2: Representing Integers on a Number Line</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

A <b>number line</b> is used to represent integers.<br>
- Numbers to the right of zero are positive.<br>
- Numbers to the left of zero are negative.<br><br>

<b>Example:</b>  
‚Ä¶ -4, -3, -2, -1, 0, 1, 2, 3, 4 ‚Ä¶<br><br>

Zero separates positive and negative integers.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
How are positive and negative integers represented on a number line?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Positive integers are placed to the right of zero, while negative integers are placed to the left of zero.<br>
`,

`<span style="color:purple;"><b>Lesson 3: Addition of Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Rules for addition:<br>
<ul>
  <li>If the signs are the same ‚Üí Add the numbers and keep the sign.</li>
  <li>If the signs are different ‚Üí Subtract the smaller number from the larger and take the sign of the larger number.</li>
</ul><br>

<b>Examples:</b><br>
- (+3) + (+4) = +7<br>
- (-5) + (-2) = -7<br>
- (+6) + (-4) = +2<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Find the sum: (a) -7 + (-5), (b) 9 + (-3)<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
(a) -12<br>
(b) 6<br>
`,

`<span style="color:purple;"><b>Lesson 4: Subtraction of Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Subtraction of integers can be changed into addition:<br>
<b>a - b = a + (-b)</b><br><br>

<b>Examples:</b><br>
- 7 - 3 = 7 + (-3) = 4<br>
- (-5) - 4 = (-5) + (-4) = -9<br>
- (-6) - (-2) = (-6) + 2 = -4<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Simplify: (a) -8 - 3, (b) -10 - (-6)<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
(a) -11<br>
(b) -4<br>
`,

`<span style="color:purple;"><b>Lesson 5: Multiplication of Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Rules for multiplication:<br>
<ul>
  <li>Positive √ó Positive = Positive</li>
  <li>Negative √ó Negative = Positive</li>
  <li>Positive √ó Negative = Negative</li>
</ul><br>

<b>Examples:</b><br>
- 4 √ó 3 = 12<br>
- (-5) √ó (-2) = 10<br>
- (-6) √ó 3 = -18<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Evaluate: (a) -7 √ó 4, (b) -8 √ó -5<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
(a) -28<br>
(b) 40<br>
`,

`<span style="color:purple;"><b>Lesson 6: Division of Integers</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Rules for division:<br>
<ul>
  <li>Positive √∑ Positive = Positive</li>
  <li>Negative √∑ Negative = Positive</li>
  <li>Positive √∑ Negative = Negative</li>
</ul><br>

<b>Examples:</b><br>
- 12 √∑ 3 = 4<br>
- (-20) √∑ (-5) = 4<br>
- (-15) √∑ 3 = -5<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Simplify: (a) -24 √∑ 6, (b) -30 √∑ -5<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
(a) -4<br>
(b) 6<br>
`,

`<span style="color:purple;"><b>Lesson 7: Application of Integers in Real Life</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Integers are used in everyday life:<br>
<ul>
  <li>Temperature: -5¬∞C means 5 degrees below zero.</li>
  <li>Banking: Negative numbers represent debts or withdrawals.</li>
  <li>Elevations: Negative heights represent positions below sea level.</li>
  <li>Sports: Scores may involve positive or negative points.</li>
</ul><br>

<span style="color:orange;"><b>Question:</b></span><br>
Give two examples of how integers are used in daily life.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Integers are used to show temperatures below zero and bank account debts.<br>
`], Science: [`<span style="color:purple;"><b>Lesson 1: Introduction to Alloys</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

An alloy is a mixture of two or more elements, where at least one element is a metal. Alloys are created to improve the properties of pure metals, such as strength, corrosion resistance, and durability. Alloys are widely used in construction, machinery, and daily life.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What is an alloy and why are alloys made?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
An alloy is a mixture of two or more elements, at least one being a metal. Alloys are made to enhance properties like strength, durability, and resistance to corrosion.<br>
`,

`<span style="color:purple;"><b>Lesson 2: Brass</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Brass is an alloy made from copper and zinc. It has an attractive golden color and is resistant to corrosion. Because of these properties, brass is used in taps, musical instruments, decorative items, and fittings.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What elements make brass and what are its uses?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Brass is made of copper and zinc. It is used in taps, musical instruments, decorative items, and fittings.<br>
`,

`<span style="color:purple;"><b>Lesson 3: Bronze</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Bronze is an alloy of copper and tin. It is strong, durable, and resistant to corrosion. Bronze is commonly used for making statues, coins, medals, and some tools.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What is bronze made of and what are its uses?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Bronze is made of copper and tin. It is used for statues, coins, medals, and tools.<br>
`,

`<span style="color:purple;"><b>Lesson 4: Steel</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Steel is an alloy of iron and carbon. It is much stronger than pure iron and is widely used in construction, vehicles, machinery, and tools. The addition of carbon increases the hardness and strength of iron.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What elements make steel and why is it stronger than iron?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Steel is made of iron and carbon. It is stronger than iron because carbon increases hardness and strength.<br>
`,

`<span style="color:purple;"><b>Lesson 5: Stainless Steel</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Stainless steel is an alloy of iron, chromium, and nickel. It does not rust easily, making it suitable for kitchen sinks, surgical instruments, and cutlery. Chromium and nickel improve corrosion resistance and durability.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What elements make stainless steel and why is it preferred?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Stainless steel is made of iron, chromium, and nickel. It is preferred because it resists rust and corrosion.<br>
`,

`<span style="color:purple;"><b>Lesson 6: Solder</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Solder is an alloy of tin and lead. It is commonly used for joining metal parts, especially in electronics. Solder melts at a low temperature, allowing metals to be joined without damage.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What is solder made of and what is it used for?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Solder is made of tin and lead. It is used for joining metal parts in electronics.<br>
`,

`<span style="color:purple;"><b>Lesson 7: Importance of Alloys</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Alloys combine the advantages of their component metals while reducing weaknesses. They are stronger, more durable, and often more resistant to corrosion than pure metals. Understanding alloys helps in selecting the right materials for engineering, construction, and technology.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Why are alloys important compared to pure metals?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Alloys are stronger, more durable, and more resistant to corrosion than pure metals, making them important for engineering, construction, and technology.<br>
`

], English: ["<h2>English Lesson 1</h2><p>Grammar‚Ä¶</p>"] },
  Thu: { Math: ["<h2>Math Lesson 1</h2><p>Quadratic Equations‚Ä¶</p>"], Science: [`<span style="color:purple;"><b>Lesson 1: What is an Atom?</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

An atom is the smallest particle of an element that can take part in a chemical reaction. Everything around us‚Äîincluding air, water, and food‚Äîis made of atoms. Although atoms are extremely small and cannot be seen with the naked eye, scientists have discovered a great deal about their structure.<br>
Understanding atoms helps explain the properties of matter and how substances react with one another.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Define an atom and explain its importance in chemistry.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
An atom is the smallest particle of an element that can take part in chemical reactions. It is important because all matter is made of atoms, and chemical reactions involve the rearrangement of atoms.<br>
`,

`<span style="color:purple;"><b>Lesson 2: Subatomic Particles</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Each atom consists of three main subatomic particles:<br>
<ul>
<li><b>Protons:</b> Positively charged particles located in the nucleus.</li>
<li><b>Neutrons:</b> Neutral particles in the nucleus.</li>
<li><b>Electrons:</b> Negatively charged particles moving around the nucleus in energy levels.</li>
</ul>
The nucleus contains almost all the atom‚Äôs mass. Electrons occupy energy levels around the nucleus and determine how atoms react.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Name the three subatomic particles and their charges.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Protons (+), Neutrons (0), Electrons (-).<br>
`,

`<span style="color:purple;"><b>Lesson 3: Atomic Number</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

The atomic number (Z) of an atom is the number of protons in its nucleus. It determines the identity of an element. For example, a carbon atom has 6 protons, so its atomic number is 6.<br>
Atoms of the same element always have the same atomic number.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
An atom has 11 protons. What is its atomic number?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Atomic number = 11.<br>
`,

`<span style="color:purple;"><b>Lesson 4: Mass Number</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

The mass number (A) is the total number of protons and neutrons in the nucleus of an atom. Example: Carbon has 6 protons and 6 neutrons ‚Üí mass number = 12.<br>
Mass number helps distinguish isotopes, which have the same atomic number but different numbers of neutrons.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
An atom has 11 protons and 12 neutrons. Find its mass number.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Mass number = 11 + 12 = 23.<br>
`,

`<span style="color:purple;"><b>Lesson 5: Isotopes</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Isotopes are atoms of the same element with the same number of protons but different numbers of neutrons. They have similar chemical properties but different mass numbers.<br>
Examples:<br>
- Carbon-12 and Carbon-14 are isotopes of carbon.<br>
- Hydrogen isotopes: Protium (1H), Deuterium (2H), Tritium (3H).<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Define isotopes and give one example.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Isotopes are atoms of the same element with different numbers of neutrons. Example: Carbon-12 and Carbon-14.<br>
`,

`<span style="color:purple;"><b>Lesson 6: Electron Arrangement (Energy Levels)</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Electrons occupy energy levels around the nucleus. Each energy level can hold a limited number of electrons:<br>
<ul>
<li>1st energy level: 2 electrons</li>
<li>2nd energy level: 8 electrons</li>
<li>3rd energy level: 8 electrons (for elements up to atomic number 20)</li>
</ul>
Electrons always fill the lowest available energy level first. This arrangement is called electron configuration.<br>
Examples:<br>
- Oxygen (Z=8) ‚Üí 2 electrons in the 1st energy level, 6 in the 2nd ‚Üí configuration: 2,6<br>
- Magnesium (Z=12) ‚Üí 2,8,2<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Write the electron configuration for Oxygen and Magnesium.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Oxygen: 2,6; Magnesium: 2,8,2.<br>
`,

`<span style="color:purple;"><b>Lesson 7: Energy Level Diagrams (Bohr Models)</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Bohr diagrams show the arrangement of electrons in energy levels around the nucleus. Each level contains a specific number of electrons. Example: Neon (Z=10) ‚Üí 2 electrons in the 1st energy level, 8 in the 2nd ‚Üí configuration: 2,8.<br>
Energy level diagrams help predict chemical behavior and bonding of elements.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Draw or describe the Bohr diagram for Neon.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Neon has 2 electrons in the first energy level and 8 in the second ‚Üí 2,8.<br>
`
], English: ["<h2>English Lesson 1</h2><p>Writing‚Ä¶</p>"] },
  Fri: { Math: ["<h2>Math Lesson 1</h2><p>Quadratics‚Ä¶</p>"], Science: [`<span style="color:purple;"><b>Lesson 1: Introduction to Classification of Elements</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Elements in the Periodic Table can be divided into two major groups: <b>metals</b> and <b>non-metals</b>. This classification is based on physical and chemical properties. Metals are mostly on the left and center of the Periodic Table, while non-metals are on the right side. Understanding these groups helps predict the behavior of elements in chemical reactions.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What are the two main groups of elements in the Periodic Table?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Metals and non-metals.<br>
`,

`<span style="color:purple;"><b>Lesson 2: Physical Properties of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Metals are generally solid (except mercury), shiny, and strong. They are good conductors of heat and electricity. Metals are also malleable, meaning they can be hammered into thin sheets, and ductile, meaning they can be drawn into wires. These properties make metals useful in construction, electronics, and manufacturing.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
List three physical properties of metals.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Shiny, malleable, ductile, and good conductors of heat and electricity.<br>
`,

`<span style="color:purple;"><b>Lesson 3: Chemical Properties of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Metals tend to lose electrons during chemical reactions and form positively charged ions (cations). For example, sodium (Na) loses one electron to form Na<sup>+</sup>, and calcium (Ca) loses two electrons to form Ca<sup>2+</sup>. Metals react with oxygen to form metal oxides, which are usually basic.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What type of ions do metals form during chemical reactions?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Metals form positively charged ions called cations.<br>
`,

`<span style="color:purple;"><b>Lesson 4: Examples of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Some common metals and their uses:<br>
<ul>
<li><b>Iron (Fe):</b> Strong, used in construction and machinery.</li>
<li><b>Copper (Cu):</b> Excellent conductor of electricity, used in wires.</li>
<li><b>Aluminum (Al):</b> Lightweight, used in aircraft and packaging.</li>
</ul><br>

<span style="color:orange;"><b>Question:</b></span><br>
Give two examples of metals and one use for each.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Iron: construction; Copper: electrical wires.<br>
`,

`<span style="color:purple;"><b>Lesson 5: Physical Properties of Non-Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Non-metals are usually poor conductors of heat and electricity. Many non-metals are gases at room temperature, while others are brittle solids. Non-metals are dull in appearance and break easily when hammered.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
List three physical properties of non-metals.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Poor conductors of heat/electricity, dull, brittle.<br>
`,

`<span style="color:purple;"><b>Lesson 6: Chemical Properties of Non-Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Non-metals tend to gain electrons during chemical reactions to form negatively charged ions (anions). For example, chlorine (Cl) gains one electron to form Cl<sup>-</sup>. Non-metals react with metals to form ionic compounds, and with other non-metals to form covalent compounds.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What type of ions do non-metals form?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Non-metals form negatively charged ions called anions.<br>
`,

`<span style="color:purple;"><b>Lesson 7: Examples of Non-Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Some common non-metals and their uses:<br>
<ul>
<li><b>Oxygen (O):</b> Essential for respiration.</li>
<li><b>Nitrogen (N):</b> Makes up most of the Earth's atmosphere.</li>
<li><b>Chlorine (Cl):</b> Used to disinfect water.</li>
</ul><br>

<span style="color:orange;"><b>Question:</b></span><br>
Give two examples of non-metals and their uses.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Oxygen: respiration; Chlorine: disinfect water.<br>
`
], English: ["<h2>English Lesson 1</h2><p>Comprehension‚Ä¶</p>"] },
  Sat: { Math: ["<h2>Math Lesson 1</h2><p>Quadratics‚Ä¶</p>"], Science: [`<span style="color:purple;"><b>Lesson 1: Introduction to Physical Properties of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Metals have unique physical properties that make them useful in everyday life. These properties include shine, conductivity, malleability, ductility, sonority, high melting points, and strength. Understanding these properties helps us choose metals for construction, manufacturing, electrical wiring, and tools.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Why are metals widely used in everyday life?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Metals have unique physical properties like shine, conductivity, malleability, ductility, sonority, high melting points, and strength, which make them useful in construction, manufacturing, and technology.<br>
`,

`<span style="color:purple;"><b>Lesson 2: Lustre of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Lustre is the property of metals that allows them to shine when polished. This makes metals attractive for use in jewelry, ornaments, and decorations. Lustrous metals include gold, silver, and copper.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What does lustre mean and give an example?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Lustre is the shiny appearance of metals when polished. Examples: gold, silver.<br>
`,

`<span style="color:purple;"><b>Lesson 3: Conductivity of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Metals are good conductors of heat and electricity. This property allows metals like copper and aluminum to be used in electrical wiring and cooking utensils. Conductivity is essential in technology and domestic life.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Why are copper and aluminum used in electrical wiring?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Because they are good conductors of electricity.<br>
`,

`<span style="color:purple;"><b>Lesson 4: Malleability of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Malleability is the ability of metals to be hammered or rolled into thin sheets without breaking. Aluminum foil is an example of a malleable metal. Malleability makes metals useful in manufacturing and packaging.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What is malleability? Give an example.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Malleability is the ability of metals to be hammered or rolled into thin sheets without breaking. Example: Aluminum foil.<br>
`,

`<span style="color:purple;"><b>Lesson 5: Ductility of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Ductility is the ability of metals to be drawn into wires without breaking. Copper wires used in electric cables demonstrate this property. Ductility is important in electrical and mechanical applications.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Define ductility and give an example.<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Ductility is the ability of metals to be stretched into wires without breaking. Example: Copper wires.<br>
`,

`<span style="color:purple;"><b>Lesson 6: Sonority and High Melting Points</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Metals are sonorous, meaning they produce a ringing sound when struck. This property is useful in making bells and musical instruments. Metals also have high melting and boiling points, allowing them to withstand high temperatures, making them suitable for engines and machinery.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
What does sonorous mean? Why are high melting points important?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Sonorous means producing a ringing sound when struck. High melting points allow metals to withstand high temperatures in engines and machinery.<br>
`,

`<span style="color:purple;"><b>Lesson 7: Strength and Applications of Metals</b></span><br><br>

<span style="color:green;"><b>Lesson Content:</b></span><br><br>

Metals are generally strong and hard, making them suitable for building, engineering, and construction purposes. Strength and durability make metals essential in bridges, buildings, vehicles, and machinery.<br><br>

<span style="color:orange;"><b>Question:</b></span><br>
Why is strength an important property of metals?<br><br>

<span style="color:blue;"><b>Final Answer:</b></span><br>
Strength makes metals suitable for construction, engineering, and machinery.<br>
`
], English: ["<h2>English Lesson 1</h2><p>Grammar‚Ä¶</p>"] }
};

let currentLesson = 0;
let todayLessons = [];
let selectedVoice = null;
let utter = null;

/* ---------- VOICE ---------- */
function getVoice(){
  const voices = speechSynthesis.getVoices();
  return voices.find(v=>v.lang.startsWith("en-ke") && v.name.toLowerCase().includes("female"))
         || voices.find(v=>v.lang.startsWith("en-ke"))
         || voices.find(v=>v.lang.startsWith("en-gb"))
         || voices[0];
}

function speak(html){
  const tmp = document.createElement("div");
  tmp.innerHTML = html;
  speechSynthesis.cancel();
  utter = new SpeechSynthesisUtterance(tmp.textContent);
  utter.voice = selectedVoice;
  utter.rate = 0.8;
  speechSynthesis.speak(utter);
}

/* ---------- START TUTOR ---------- */
function startTutor(){
  if(!user){ alert("‚ö†Ô∏è Please login first."); return; }

  db.ref("students/" + user.uid).once("value").then(snap => {
    if(!snap.exists() || !snap.val().phone){
      alert("‚ö†Ô∏è Enter your phone number first.");
      document.getElementById("phoneForm").style.display = "block";
      return;
    }

    const now = new Date();
    const kenyaTime = new Date(now.getTime() + (3*60 + now.getTimezoneOffset())*60000);
    const days = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
    const todayName = days[kenyaTime.getDay()];

    const slots = timetable[todayName] || [];
    const currentSlot = slots.find(slot => inTimeRange(slot.start, slot.end, kenyaTime));

    if(!currentSlot){
      editor.innerHTML = "<div class='card'><h2>‚è≥ No active lesson right now. Check the timetable.</h2></div>";
      status.textContent = "No active lesson";
      return;
    }

    todayLessons = lessonsArray[todayName][currentSlot.subject] || [`<div><h2>${currentSlot.subject} Lesson</h2><p>Lesson coming soon.</p></div>`];
    
    const waitVoices = setInterval(()=>{
      if(speechSynthesis.getVoices().length){
        clearInterval(waitVoices);
        selectedVoice = getVoice();
        currentLesson = 0;
        showLesson();
      }
    }, 100);
  });
}

/* ---------- SHOW CURRENT LESSON ---------- */
function showLesson(){
  if(currentLesson >= todayLessons.length) {
    editor.innerHTML = "<div class='card'><h2>‚úÖ All lessons for this slot are done!</h2></div>";
    return;
  }
  const lessonHtml = todayLessons[currentLesson];
  editor.innerHTML = `<div class='card'>${lessonHtml}</div>`;
  speak(lessonHtml);
  currentLesson++;
}




// Realtime Database reference
const db = firebase.database();

const ratingStars = document.querySelectorAll(".rating span");
const avgRatingEl = document.getElementById("avgRating");

// Add a container for the delayed message
let ratingTimeout;
let ratingMessage = document.getElementById("ratingMessage");
if (!ratingMessage) {
  ratingMessage = document.createElement("div");
  ratingMessage.id = "ratingMessage";
  ratingMessage.style.cssText = `
    display:none; 
    color:#388e3c; 
    font-weight:bold; 
    margin-bottom:10px; 
    opacity:0; 
    transform:translateY(-10px); 
    transition: all 0.5s ease;
  `;
  document.querySelector(".card").prepend(ratingMessage);
}

// Function to update stars visually
function updateStars(val) {
  ratingStars.forEach(s => {
    s.classList.toggle("active", s.dataset.v <= val);
  });
}

// Function to update average rating live
function updateAverageRating() {
  db.ref("ratings").on("value", snapshot => {
    let total = 0, count = 0;
    snapshot.forEach(child => {
      total += child.val().rating;
      count++;
    });

    const avg = count ? (total / count).toFixed(1) : 0;

    // Update the display with average and number of ratings
    avgRatingEl.textContent = count 
      ? `${avg} (${count} students)` 
      : "No ratings yet";

    // Optional: update stars to reflect average visually
    ratingStars.forEach(s => {
      s.classList.toggle("hover", s.dataset.v <= avg);
    });
  });
}

// Call it once to start listening for live updates
updateAverageRating();

// Attach click events to stars
ratingStars.forEach(star => {
  star.addEventListener("click", async () => {
    if (!user) return alert("‚ö†Ô∏è Login first to save rating.");
    const val = parseInt(star.dataset.v);

    // Save/update user's rating
    await db.ref("ratings/" + user.uid).set({
      name: user.displayName,
      rating: val,
      timestamp: Date.now()
    });

    // Update stars visually for this user
    updateStars(val);

    // Clear previous timeout if any
    if (ratingTimeout) clearTimeout(ratingTimeout);

    // Delay message 5 seconds
    ratingTimeout = setTimeout(() => {
      ratingMessage.textContent = `Thanks! You rated ${val}‚≠ê`;
      ratingMessage.style.display = "block";
      setTimeout(() => {
        ratingMessage.style.opacity = 1;
        ratingMessage.style.transform = "translateY(0)";
      }, 10);

      // Fade out after 3s
      setTimeout(() => {
        ratingMessage.style.opacity = 0;
        ratingMessage.style.transform = "translateY(-10px)";
        setTimeout(() => { ratingMessage.style.display = "none"; }, 500);
      }, 3000);

      ratingTimeout = null;
    }, 5000);
  });

  // Optional: hover effect
  star.addEventListener("mouseover", () => updateStars(star.dataset.v));
  star.addEventListener("mouseout", () => {
    if (user) {
      db.ref("ratings/" + user.uid).once("value", snap => {
        const val = snap.exists() ? snap.val().rating : 0;
        updateStars(val);
      });
    }
  });
});

// When user logs in, show their previous rating
auth.onAuthStateChanged(u => {
  user = u;
  if (user) {
    db.ref("ratings/" + user.uid).once("value", snap => {
      if (snap.exists()) updateStars(snap.val().rating);
    });
  }
});



function savePhoneNumber() {
  const phone = document.getElementById("phoneInput").value.trim();
  if (!phone) {
    alert("‚ö†Ô∏è Please enter your phone number.");
    return;
  }

  db.ref("students/" + user.uid).update({
    phone: phone,
    timestamp: Date.now()
  }).then(() => {
    alert("‚úÖ Phone number saved! Lessons unlocked.");
    document.getElementById("phoneForm").style.display = "none";
    document.querySelector(".card").style.display = "block";
    editor.scrollIntoView({behavior: "smooth"});
  });
}


  
function showLesson(){
  editor.innerHTML=`<div class="card">${todayLessons[currentLesson]}</div>`;
  speak(todayLessons[currentLesson]);
}

function prevLesson(){
  if(todayLessons.length && currentLesson>0){
    currentLesson--;
    showLesson();
  }
}
function nextLesson(){
  if(todayLessons.length && currentLesson<todayLessons.length-1){
    currentLesson++;
    showLesson();
  }
}
function pauseTutor(){speechSynthesis.pause();status.textContent="‚è∏Ô∏è Paused";}
function resumeTutor(){speechSynthesis.resume();status.textContent="‚ñ∂Ô∏è Resumed";}
function contactWhatsApp(){window.open("https://wa.me/254769255782","_blank");}
  
</script>
</body>
</html>
