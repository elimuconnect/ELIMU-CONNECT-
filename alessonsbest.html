<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Tutor ‚Äì Daily Live Lessons</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { box-sizing: border-box; }
html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right,#e0f7fa,#fce4ec);
}
#app { display: flex; flex-direction: column; height: 100vh; }
#toolbar {
  padding: 15px;
  background: #1976d2;
  color: white;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}
#toolbar button {
  background: white;
  color: #1976d2;
  padding: 12px 20px;
  border: none;
  border-radius: 30px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s ease;
}
#toolbar button:hover { background: #f0f0f0; }
#editor {
  flex: 1;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}
/* ‚úÖ NEW CARD STYLE */
.card {
  max-width: 90vw;
  width: 100%;
  margin: 20px auto;
  padding: 40px;
  background: white;
  border-radius: 25px;
  border: 2px solid #ccc; /* Added border for prominence */
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  font-size: 1.8em;
  line-height: 2;
  font-weight: bold;
  animation: fadeIn 1s ease;
  overflow-wrap: break-word;
  word-break: break-word;
  color: #1a237e;
  box-sizing: border-box;
  transition: all 0.3s ease-in-out; /* Smooth hover or layout changes */
}

/* Headings inside cards */
.card h2 {
  margin-top: 0;
  font-size: 2em;
  font-weight: bold;
}

/* Optional manual title colors */
.card h2.red    { color: #d81b60; }
.card h2.green  { color: #2e7d32; }
.card h2.blue   { color: #1565c0; }
.card h2.orange { color: #ef6c00; }
.card h2.purple { color: #6a1b9a; }

/* Automatic color cycling for h2s inside cards */
.card h2:nth-child(5n+1) { color: #d81b60; }
.card h2:nth-child(5n+2) { color: #2e7d32; }
.card h2:nth-child(5n+3) { color: #1565c0; }
.card h2:nth-child(5n+4) { color: #ef6c00; }
.card h2:nth-child(5n+5) { color: #6a1b9a; }

.card pre {
  white-space: pre-wrap;
  overflow-wrap: break-word;
  word-break: break-word;
  font-size: 1.6em;
  line-height: 2;
  font-weight: bold;
  color: #1a237e;
}

#status {
  padding: 15px;
  background: #388e3c;
  color: white;
  font-weight: bold;
  text-align: center;
  font-size: 16px;
}

@keyframes fadeIn {
  from { opacity: 0; transform: translateY(20px); }
  to   { opacity: 1; transform: translateY(0); }
}

/* ‚úÖ Mobile adjustments */
@media (max-width: 600px) {
  #toolbar {
    flex-direction: column;
    gap: 8px;
    padding: 10px;
  }

  #toolbar button {
    width: 100%;
    font-size: 16px;
    padding: 10px;
  }

  .card {
    padding: 20px;
    font-size: 1.2em;
  }

  .card h2 {
    font-size: 1.4em;
  }

  .card pre {
    font-size: 1.15em;
  }

  #status {
    font-size: 15px;
    padding: 10px;
  }
}

/* Extra formatting helpers for lesson text */
.lesson-title {
  color: #d32f2f; /* Deep red */
  font-size: 1.2em;
  display: block;
  margin: 10px 0;
}
.subtopic {
  color: #1976d2; /* Blue */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.question {
  color: #f57c00; /* Orange */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.answer {
  color: #388e3c; /* Green */
  font-weight: bold;
  display: block;
  margin-top: 15px;
}
.bullet {
  color: #6a1b9a; /* Purple dot */
  margin-right: 8px;
}
.point {
  color: #1a237e;
  display: block;
  margin-left: 20px;
}


.rating {
  margin-top: 20px;
  font-size: 2em;
  color: #ccc;            /* Default gray */
  display: inline-block;
  cursor: pointer;
  user-select: none;
}
.rating span {
  transition: color 0.3s;
}
.rating span.hover,
.rating span.selected {
  color: gold;            /* Highlighted star */
}


  
</style>
</head>
<body>
<div id="app">

  <div id="toolbar">
    <button id="loginBtn">üîë Google Login</button>
    <button onclick="startTutor()">‚ñ∂Ô∏è Start Tutor</button>
    <button onclick="pauseTutor()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeTutor()">‚ñ∂Ô∏è Resume</button>
    <button onclick="prevLesson()">‚¨ÖÔ∏è Back</button>
    <button onclick="nextLesson()">‚û°Ô∏è Next</button>
    <button onclick="contactWhatsApp()">üí¨ Customer Care</button>
  </div>

  <div id="editor">
  <div class="card">
    <!-- Rating message container -->
    <div id="ratingMessage" style="display:none; color:#388e3c; font-weight:bold; margin-bottom:10px; 
         opacity:0; transform:translateY(-10px); transition: all 0.5s ease;"></div>

    <h2>Welcome to Smart Tutor</h2>
    <p>Login with Google to access daily CBC lessons (Mon‚ÄìSat) with live voice narration.  
    Maths √ó3 ‚Ä¢ Integrated Science √ó2 ‚Ä¢ English √ó1</p>
    <p>Lessons open daily 4 PM ‚Äì 11 PM (Kenya time).</p>

    <div class="rating" id="ratingStars">
      <p style="font-size:0.6em;margin:5px 0;">Rate this Tutor:</p>
      <span data-v="1">‚òÖ</span>
      <span data-v="2">‚òÖ</span>
      <span data-v="3">‚òÖ</span>
      <span data-v="4">‚òÖ</span>
      <span data-v="5">‚òÖ</span>
    </div>

    <p id="ratingValue" style="font-size:0.6em;color:#1976d2;margin-top:6px;">
  Average Rating: <span id="avgRating">‚Äì</span> ‚òÖ
</p>

  </div>
</div>

<div id="lessonContainer"></div>
<div id="status">‚è≥ Ready‚Ä¶</div>


<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>

<script>
/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCAiOSHmURDyAAYm5EmoomLkZ_Aud7iXIQ",
  authDomain: "cbc-general.firebaseapp.com",
  projectId: "cbc-general"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
/* -------------------------------------- */

const editor = document.getElementById("editor");
const status = document.getElementById("status");
const loginBtn = document.getElementById("loginBtn");

let user=null;
loginBtn.onclick=()=>{
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
      .then(res=>{
        user=res.user;
        status.textContent=`üëã Hi ${user.displayName}`;
      })
      .catch(e=>alert(e.message));
};
auth.onAuthStateChanged(u=>{
  user=u;
  if(u) status.textContent=`üëã Hi ${u.displayName}`;
});

/* ---------- LESSONS (Mon‚ÄìSat) ---------- */

const lessonsArray = {
  "Mon": [
    `<span style="color:purple;"><b>Lesson 1:</b> Monday Sample Lesson</span>`
  ],

  "Tue": [
    `<span style="color: purple; font-size: 1.2em;"><b>Install Elimu Connect App</b></span> 
     from Play Store or visit 
     <a href="https://elimuconnect.github.io/ELIMU-CONNECT-/elimu" target="_blank">
     https://elimuconnect.github.io/ELIMU-CONNECT-/elimu</a> 
     for CBC academic & CODING lessons<br><br>

     <span style="color:purple;"><b>Lesson 1: Introduction to Integers</b></span><br><br>

     <span style="color:green;"><b>Lesson Content:</b></span><br><br>

     <b>Integers</b> are the set of whole numbers and their negatives, including zero.<br><br>

     <b>Examples:</b>
     <ul>
       <li>Positive integers: 1, 2, 3, ‚Ä¶</li>
       <li>Negative integers: -1, -2, -3, ‚Ä¶</li>
       <li>Zero: 0 (neutral, not positive or negative)</li>
     </ul><br>

     On a number line, integers extend infinitely in both directions.<br><br>

     <span style="color:orange;"><b>Question:</b></span><br>
     What are integers? Give three examples.<br><br>

     <span style="color:blue;"><b>Final Answer:</b></span><br>
     Integers are whole numbers and their negatives including zero.<br>
     Examples: -3, 0, 5.<br>
    `,

    `<span style="color:purple;"><b>Lesson 2: Representing Integers on a Number Line</b></span><br><br>
     <span style="color:green;"><b>Lesson Content:</b></span><br><br>
     A <b>number line</b> is used to represent integers.<br>
     - Numbers to the right of zero are positive.<br>
     - Numbers to the left of zero are negative.<br><br>
     <b>Example:</b> ‚Ä¶ -4, -3, -2, -1, 0, 1, 2, 3, 4 ‚Ä¶<br><br>
     Zero separates positive and negative integers.<br><br>
     <span style="color:orange;"><b>Question:</b></span><br>
     How are positive and negative integers represented on a number line?<br><br>
     <span style="color:blue;"><b>Final Answer:</b></span><br>
     Positive integers are placed to the right of zero, while negative integers are placed to the left of zero.<br>
    `,

    `<span style="color:purple;"><b>Lesson 3: Addition of Integers</b></span><br><br>
     <span style="color:green;"><b>Lesson Content:</b></span><br><br>
     Rules for addition:
     <ul>
       <li>If the signs are the same ‚Üí Add the numbers and keep the sign.</li>
       <li>If the signs are different ‚Üí Subtract the smaller number from the larger and take the sign of the larger number.</li>
     </ul><br>
     <b>Examples:</b><br>
     - (+3) + (+4) = +7<br>
     - (-5) + (-2) = -7<br>
     - (+6) + (-4) = +2<br><br>
     <span style="color:orange;"><b>Question:</b></span><br>
     Find the sum: (a) -7 + (-5), (b) 9 + (-3)<br><br>
     <span style="color:blue;"><b>Final Answer:</b></span><br>
     (a) -12<br>
     (b) 6<br>
    `,

    // Add Lesson 4 ... Lesson 7 here exactly the same way
  ],

  "Wed": [
    `<span style="color:purple;"><b>Lesson 3:</b> Addition of Integers‚Ä¶</span>`
  ],
  "Thu": [
    `<span style="color:purple;"><b>Lesson 4:</b> Subtraction of Integers‚Ä¶</span>`
  ],
  "Fri": [
    `<span style="color:purple;"><b>Lesson 5:</b> Multiplication of Integers‚Ä¶</span>`
  ],
  "Sat": [
    `<span style="color:purple;"><b>Lesson 6:</b> Division of Integers‚Ä¶</span>`
  ]
};

// Display lessons only for **today**
const dayNames = ["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
const today = dayNames[new Date().getDay()];
const container = document.getElementById("lessonContainer");
const todaysLessons = lessonsArray[today] || [];












  

let currentLesson = 0;
let todayLessons = [];
let selectedVoice=null;
let utter=null;

/* ---------- Voice ---------- */
function getVoice(){
  const v=speechSynthesis.getVoices();
  return v.find(x=>x.lang.toLowerCase().startsWith("en-ke")&&x.name.toLowerCase().includes("female"))
      || v.find(x=>x.lang.toLowerCase().startsWith("en-ke"))
      || v.find(x=>x.lang.toLowerCase().startsWith("en-gb"))
      || v[0];
}
function speak(html){
  const tmp=document.createElement("div");
  tmp.innerHTML=html;
  speechSynthesis.cancel();
  utter=new SpeechSynthesisUtterance(tmp.textContent);
  utter.voice=selectedVoice;
  utter.rate=0.8;
  speechSynthesis.speak(utter);
}

/* ---------- Start Tutor ---------- */
function startTutor(){
  if(!user){alert("‚ö†Ô∏è Please login with Google first.");return;}

  const days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  const nowUTC=new Date();
  const kenyaTime=new Date(nowUTC.getTime()+(3*60+nowUTC.getTimezoneOffset())*60000);
  const dayName=days[kenyaTime.getDay()];
  const hour=kenyaTime.getHours();

  if(hour<16 || hour>=23){
    editor.innerHTML=`<div class='card'><h2>‚è≥ Lessons open 4 PM ‚Äì 11 PM Kenya time.</h2></div>`;
    status.textContent="‚õî Outside lesson hours";
    return;
  }

  todayLessons = lessonsArray[dayName] || [];
  if(!todayLessons.length){
    editor.innerHTML=`<div class='card'><h2>üéâ No lessons scheduled for ${dayName}</h2></div>`;
    status.textContent="No lesson today";
    return;
  }

  const check=setInterval(()=>{
    if(speechSynthesis.getVoices().length){
      clearInterval(check);
      selectedVoice=getVoice();
      currentLesson=0;
      showLesson();
      status.textContent=`üü¢ Showing lessons for ${dayName}`;
    }
  },200);
}

function showLesson(){
  editor.innerHTML=`<div class="card">${todayLessons[currentLesson]}</div>`;
  speak(todayLessons[currentLesson]);
}

function prevLesson(){
  if(todayLessons.length && currentLesson>0){
    currentLesson--;
    showLesson();
  }
}
function nextLesson(){
  if(todayLessons.length && currentLesson<todayLessons.length-1){
    currentLesson++;
    showLesson();
  }
}
function pauseTutor(){speechSynthesis.pause();status.textContent="‚è∏Ô∏è Paused";}
function resumeTutor(){speechSynthesis.resume();status.textContent="‚ñ∂Ô∏è Resumed";}
function contactWhatsApp(){window.open("https://wa.me/254769255782","_blank");}

// Realtime Database reference
const db = firebase.database();

const ratingStars = document.querySelectorAll(".rating span");
const avgRatingEl = document.getElementById("avgRating");

// Add a container for the delayed message
let ratingTimeout;
let ratingMessage = document.getElementById("ratingMessage");
if (!ratingMessage) {
  ratingMessage = document.createElement("div");
  ratingMessage.id = "ratingMessage";
  ratingMessage.style.cssText = `
    display:none; 
    color:#388e3c; 
    font-weight:bold; 
    margin-bottom:10px; 
    opacity:0; 
    transform:translateY(-10px); 
    transition: all 0.5s ease;
  `;
  document.querySelector(".card").prepend(ratingMessage);
}

// Function to update stars visually
function updateStars(val) {
  ratingStars.forEach(s => {
    s.classList.toggle("active", s.dataset.v <= val);
  });
}

// Function to update average rating live
function updateAverageRating() {
  db.ref("ratings").on("value", snapshot => {
    let total = 0, count = 0;
    snapshot.forEach(child => {
      total += child.val().rating;
      count++;
    });

    const avg = count ? (total / count).toFixed(1) : 0;

    // Update the display with average and number of ratings
    avgRatingEl.textContent = count 
      ? `${avg} (${count} students)` 
      : "No ratings yet";

    // Optional: update stars to reflect average visually
    ratingStars.forEach(s => {
      s.classList.toggle("hover", s.dataset.v <= avg);
    });
  });
}

// Call it once to start listening for live updates
updateAverageRating();

// Attach click events to stars
ratingStars.forEach(star => {
  star.addEventListener("click", async () => {
    if (!user) return alert("‚ö†Ô∏è Login first to save rating.");
    const val = parseInt(star.dataset.v);

    // Save/update user's rating
    await db.ref("ratings/" + user.uid).set({
      name: user.displayName,
      rating: val,
      timestamp: Date.now()
    });

    // Update stars visually for this user
    updateStars(val);

    // Clear previous timeout if any
    if (ratingTimeout) clearTimeout(ratingTimeout);

    // Delay message 5 seconds
    ratingTimeout = setTimeout(() => {
      ratingMessage.textContent = `Thanks! You rated ${val}‚≠ê`;
      ratingMessage.style.display = "block";
      setTimeout(() => {
        ratingMessage.style.opacity = 1;
        ratingMessage.style.transform = "translateY(0)";
      }, 10);

      // Fade out after 3s
      setTimeout(() => {
        ratingMessage.style.opacity = 0;
        ratingMessage.style.transform = "translateY(-10px)";
        setTimeout(() => { ratingMessage.style.display = "none"; }, 500);
      }, 3000);

      ratingTimeout = null;
    }, 5000);
  });

  // Optional: hover effect
  star.addEventListener("mouseover", () => updateStars(star.dataset.v));
  star.addEventListener("mouseout", () => {
    if (user) {
      db.ref("ratings/" + user.uid).once("value", snap => {
        const val = snap.exists() ? snap.val().rating : 0;
        updateStars(val);
      });
    }
  });
});

// When user logs in, show their previous rating
auth.onAuthStateChanged(u => {
  user = u;
  if (user) {
    db.ref("ratings/" + user.uid).once("value", snap => {
      if (snap.exists()) updateStars(snap.val().rating);
    });
  }
});



</script>
</body>
</html>
