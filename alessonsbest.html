<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Tutor ‚Äì Daily Live Lessons</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
* { box-sizing: border-box; }
html, body {
  margin: 0; padding: 0; height: 100%;
  font-family: 'Segoe UI', sans-serif;
  background: linear-gradient(to right,#e0f7fa,#fce4ec);
}
#app { display: flex; flex-direction: column; height: 100vh; }
#toolbar {
  padding: 15px;
  background: #1976d2;
  color: white;
  display: flex;
  justify-content: center;
  flex-wrap: wrap;
  gap: 12px;
}
#toolbar button {
  background: white;
  color: #1976d2;
  padding: 12px 20px;
  border: none;
  border-radius: 30px;
  font-size: 16px;
  font-weight: bold;
  cursor: pointer;
  transition: 0.3s ease;
}
#toolbar button:hover { background: #f0f0f0; }
#editor {
  flex: 1;
  padding: 20px;
  display: flex;
  align-items: center;
  justify-content: center;
}
.card {
  max-width: 90vw;
  width: 100%;
  padding: 30px;
  background: white;
  border-radius: 25px;
  border: 2px solid #ccc;
  box-shadow: 0 8px 24px rgba(0,0,0,0.15);
  font-size: 1.2em;
  line-height: 1.8;
  overflow-wrap: break-word;
  color: #1a237e;
}
.card h2 { margin-top:0; color:#6a1b9a; font-size:1.6em; }
#status {
  padding: 12px;
  background: #388e3c;
  color: white;
  font-weight: bold;
  text-align: center;
}
@media (max-width:600px){
  #toolbar{flex-direction:column;}
  #toolbar button{width:100%;}
  .card{padding:20px;font-size:1em;}
}
</style>
</head>
<body>
<div id="app">

  <div id="toolbar">
    <button id="loginBtn">üîë Google Login</button>
    <button onclick="startTutor()">‚ñ∂Ô∏è Start</button>
    <button onclick="pauseTutor()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeTutor()">‚ñ∂Ô∏è Resume</button>
    <button onclick="prevLesson()">‚¨ÖÔ∏è Back</button>
    <button onclick="nextLesson()">‚û°Ô∏è Next</button>
    <button onclick="contactWhatsApp()">üí¨ WhatsApp</button>
  </div>

  <div id="editor">
    <div class="card">
      <h2>Welcome to Smart Tutor</h2>
      <p>Login with Google to access daily CBC lessons (Mon‚ÄìSat) with live voice narration.  
      Maths √ó3 ‚Ä¢ Integrated Science √ó2 ‚Ä¢ English √ó1</p>
      <p>Lessons open daily 4 PM ‚Äì 11 PM (Kenya time).</p>
    </div>
  </div>

  <div id="status">‚è≥ Ready‚Ä¶</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>

<script>
/* ---------- FIREBASE CONFIG ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyCAiOSHmURDyAAYm5EmoomLkZ_Aud7iXIQ",
  authDomain: "cbc-general.firebaseapp.com",
  projectId: "cbc-general"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
/* -------------------------------------- */

const editor = document.getElementById("editor");
const status = document.getElementById("status");
const loginBtn = document.getElementById("loginBtn");

let user=null;
loginBtn.onclick=()=>{
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
      .then(res=>{
        user=res.user;
        status.textContent=`üëã Hi ${user.displayName}`;
      })
      .catch(e=>alert(e.message));
};
auth.onAuthStateChanged(u=>{
  user=u;
  if(u) status.textContent=`üëã Hi ${u.displayName}`;
});

/* ---------- LESSONS (Mon‚ÄìSat) ---------- */
const lessonsArray = {
  "Mon":["<b>Lesson 1:</b> Introduction to Integers‚Ä¶"],
  "Tue":["<b>Lesson 2:</b> Representing Integers‚Ä¶"],
  "Wed":["<b>Lesson 3:</b> Addition of Integers‚Ä¶"],
  "Thu":["<b>Lesson 4:</b> Subtraction of Integers‚Ä¶"],
  "Fri":["<b>Lesson 5:</b> Multiplication of Integers‚Ä¶"],
  "Sat":["<b>Lesson 6:</b> Division of Integers‚Ä¶"]
};

let currentLesson = 0;
let todayLessons = [];
let selectedVoice=null;
let utter=null;

/* ---------- Voice ---------- */
function getVoice(){
  const v=speechSynthesis.getVoices();
  return v.find(x=>x.lang.toLowerCase().startsWith("en-ke")&&x.name.toLowerCase().includes("female"))
      || v.find(x=>x.lang.toLowerCase().startsWith("en-ke"))
      || v.find(x=>x.lang.toLowerCase().startsWith("en-gb"))
      || v[0];
}
function speak(html){
  const tmp=document.createElement("div");
  tmp.innerHTML=html;
  speechSynthesis.cancel();
  utter=new SpeechSynthesisUtterance(tmp.textContent);
  utter.voice=selectedVoice;
  utter.rate=0.8;
  speechSynthesis.speak(utter);
}

/* ---------- Start Tutor ---------- */
function startTutor(){
  if(!user){alert("‚ö†Ô∏è Please login with Google first.");return;}

  const days=["Sun","Mon","Tue","Wed","Thu","Fri","Sat"];
  const nowUTC=new Date();
  const kenyaTime=new Date(nowUTC.getTime()+(3*60+nowUTC.getTimezoneOffset())*60000);
  const dayName=days[kenyaTime.getDay()];
  const hour=kenyaTime.getHours();

  if(hour<16 || hour>=23){
    editor.innerHTML=`<div class='card'><h2>‚è≥ Lessons open 4 PM ‚Äì 11 PM Kenya time.</h2></div>`;
    status.textContent="‚õî Outside lesson hours";
    return;
  }

  todayLessons = lessonsArray[dayName] || [];
  if(!todayLessons.length){
    editor.innerHTML=`<div class='card'><h2>üéâ No lessons scheduled for ${dayName}</h2></div>`;
    status.textContent="No lesson today";
    return;
  }

  const check=setInterval(()=>{
    if(speechSynthesis.getVoices().length){
      clearInterval(check);
      selectedVoice=getVoice();
      currentLesson=0;
      showLesson();
      status.textContent=`üü¢ Showing lessons for ${dayName}`;
    }
  },200);
}

function showLesson(){
  editor.innerHTML=`<div class="card">${todayLessons[currentLesson]}</div>`;
  speak(todayLessons[currentLesson]);
}

function prevLesson(){
  if(todayLessons.length && currentLesson>0){
    currentLesson--;
    showLesson();
  }
}
function nextLesson(){
  if(todayLessons.length && currentLesson<todayLessons.length-1){
    currentLesson++;
    showLesson();
  }
}
function pauseTutor(){speechSynthesis.pause();status.textContent="‚è∏Ô∏è Paused";}
function resumeTutor(){speechSynthesis.resume();status.textContent="‚ñ∂Ô∏è Resumed";}
function contactWhatsApp(){window.open("https://wa.me/254769255782","_blank");}
</script>
</body>
</html>
