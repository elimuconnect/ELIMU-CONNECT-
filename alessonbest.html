<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Smart Tutor ‚Äì Daily Live Lessons</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<style>
*{box-sizing:border-box}
body{margin:0;font-family:'Segoe UI',sans-serif;background:linear-gradient(to right,#e0f7fa,#fce4ec);}
#app{display:flex;flex-direction:column;height:100vh}
#toolbar{background:#1976d2;color:#fff;padding:10px;display:flex;gap:8px;flex-wrap:wrap;justify-content:center}
#toolbar button{background:#fff;color:#1976d2;border:none;border-radius:25px;padding:10px 18px;font-weight:bold;cursor:pointer}
#toolbar button:hover{background:#f0f0f0}
#editor{flex:1;overflow:auto;padding:20px;display:flex;align-items:center;justify-content:center}
.card{max-width:900px;width:95%;background:#fff;border-radius:20px;padding:25px;box-shadow:0 6px 20px rgba(0,0,0,.2);font-size:1.2em}
#status{background:#388e3c;color:#fff;text-align:center;padding:8px;font-weight:bold}
.rating span{font-size:2em;cursor:pointer;color:#ccc}
.rating span.active{color:#ff9800}
@media(max-width:600px){.card{font-size:1em;padding:15px}}
</style>
</head>
<body>
<div id="app">

  <div id="toolbar">
    <button id="loginBtn">üîë Google Login</button>
    <button onclick="startTutor()">‚ñ∂Ô∏è Start</button>
    <button onclick="pauseTutor()">‚è∏Ô∏è Pause</button>
    <button onclick="resumeTutor()">‚ñ∂Ô∏è Resume</button>
    <button onclick="prevLesson()">‚¨ÖÔ∏è Back</button>
    <button onclick="nextLesson()">‚û°Ô∏è Next</button>
    <button onclick="contactWhatsApp()">üí¨ Customer Care</button>
  </div>

  <div id="editor">
    <div class="card">
      <h2>Welcome to Smart Tutor</h2>
      <p>Login with Google to follow live daily lessons (Mon‚ÄìSat).  
      ‚Ä¢ Maths √ó3 ‚Ä¢ Integrated Science √ó2 ‚Ä¢ English √ó1</p>
      <p>Lessons are updated weekly!</p>
      <div class="rating">
        <p>Rate this Tutor:</p>
        <span data-v="1">‚òÖ</span>
        <span data-v="2">‚òÖ</span>
        <span data-v="3">‚òÖ</span>
        <span data-v="4">‚òÖ</span>
        <span data-v="5">‚òÖ</span>
      </div>
    </div>
  </div>

  <div id="status">‚è≥ Ready‚Ä¶</div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/11.0.0/firebase-database-compat.js"></script>

<script>
/* ---------- CONFIGURE WITH YOUR FIREBASE PROJECT DETAILS ---------- */
const firebaseConfig = {
  apiKey: "AIzaSyDLTAd2u0IlhA4Gm4-0tTSzLUDHFYj045g",
  authDomain: "realestate-afbe6.firebaseapp.com",
  databaseURL: "https://realestate-afbe6-default-rtdb.firebaseio.com",
  projectId: "realestate-afbe6",
  storageBucket: "realestate-afbe6.firebasestorage.app",
  messagingSenderId: "202970291965",
  appId: "1:202970291965:web:baaf253d6c9a8685c5e894",
  measurementId: "G-S0GB80V66F"
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db   = firebase.database();
/* ------------------------------------------------------------------ */

const editor = document.getElementById("editor");
const status = document.getElementById("status");
const loginBtn = document.getElementById("loginBtn");

let user=null;
loginBtn.onclick=()=>{
  auth.signInWithPopup(new firebase.auth.GoogleAuthProvider())
      .then(res=>{user=res.user;status.textContent=`üëã Hi ${user.displayName}`;})
      .catch(e=>alert(e.message));
};

/* ----- Lessons: update weekly ----- */
const lessonsArray=[
  {day:"Mon",subject:"Maths",title:"Algebra Basics",content:"Introduction to variables and expressions."},
  {day:"Tue",subject:"Maths",title:"Linear Equations",content:"Solving one-step equations."},
  {day:"Wed",subject:"Maths",title:"Fractions",content:"Adding and subtracting fractions."},
  {day:"Thu",subject:"Integrated Science",title:"Human Body",content:"Circulatory system overview."},
  {day:"Fri",subject:"Integrated Science",title:"Energy",content:"Forms of energy and conversions."},
  {day:"Sat",subject:"English",title:"Comprehension",content:"Answering inference questions."}
];

let currentLesson=0, tutorStarted=false, paused=false, selectedVoice=null, utter=null;

function getVoice(){
  const voices=speechSynthesis.getVoices();
  return voices.find(v=>v.lang.toLowerCase().startsWith("en-ke"))
      || voices.find(v=>v.lang.toLowerCase().startsWith("en-gb"))
      || voices[0];
}

function speak(text,onEnd){
  speechSynthesis.cancel();
  utter=new SpeechSynthesisUtterance(text);
  utter.voice=selectedVoice;
  utter.rate=0.8;
  utter.onend=()=>onEnd&&onEnd();
  speechSynthesis.speak(utter);
}

function showLesson(i){
  if(i>=lessonsArray.length){editor.innerHTML="<div class='card'><h2>‚úÖ Week Complete!</h2></div>";status.textContent="All done";return;}
  const L=lessonsArray[i];
  editor.innerHTML=`<div class="card"><h2>${L.day} ‚Äì ${L.subject}</h2>
  <h3>${L.title}</h3><p>${L.content}</p></div>`;
  status.textContent=`üìñ ${L.subject} Lesson ${i+1}/${lessonsArray.length}`;
  speak(`${L.title}. ${L.content}`,()=>{if(!paused){currentLesson++;setTimeout(()=>showLesson(currentLesson),3000);}});
}

function startTutor(){
  if(tutorStarted)return;
  tutorStarted=true;
  const check=setInterval(()=>{
    if(speechSynthesis.getVoices().length){
      clearInterval(check);
      selectedVoice=getVoice();
      showLesson(currentLesson);
    }
  },200);
  status.textContent="üü¢ Starting...";
}
function pauseTutor(){paused=true;speechSynthesis.pause();status.textContent="‚è∏Ô∏è Paused";}
function resumeTutor(){paused=false;speechSynthesis.resume();status.textContent="‚ñ∂Ô∏è Resumed";}
function nextLesson(){currentLesson++;showLesson(currentLesson);}
function prevLesson(){if(currentLesson>0){currentLesson--;showLesson(currentLesson);}}

/* WhatsApp */
function contactWhatsApp(){
  window.open("https://wa.me/254769255782","_blank");
}

/* Rating */
document.querySelectorAll(".rating span").forEach(star=>{
  star.addEventListener("click",()=>{
    const val=star.dataset.v;
    document.querySelectorAll(".rating span").forEach(s=>s.classList.toggle("active",s.dataset.v<=val));
    if(user){
      db.ref("ratings/"+user.uid).set({name:user.displayName,rating:val,timestamp:Date.now()});
      alert(`Thanks! You rated ${val}‚≠ê`);
    }else alert("Login first to save rating.");
  });
});
</script>
</body>
</html>
