<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Video + Audio Merger</title>
<style>
  body {
    font-family: Arial, sans-serif;
    text-align: center;
    background: #f0f8ff;
    padding: 50px;
  }
  .container {
    background: #fff;
    padding: 20px 40px;
    border-radius: 12px;
    box-shadow: 0px 4px 10px rgba(0,0,0,0.2);
  }
  input, button {
    margin: 10px 0;
    padding: 10px;
    font-size: 16px;
  }
  button {
    cursor: pointer;
    background-color: #4caf50;
    color: white;
    border: none;
    border-radius: 6px;
  }
  button:hover {
    background-color: #45a049;
  }
  #status {
    margin-top: 15px;
    font-weight: bold;
  }
</style>
</head>
<body>
<div class="container">
  <h1>Merge Video & Audio</h1>
  <input type="file" id="videoInput" accept="video/mp4">
  <input type="file" id="audioInput" accept="audio/mp3, audio/wav">
  <button id="mergeBtn">Merge & Download</button>
  <p id="status"></p>
</div>

<!-- FFmpeg global version -->
<script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.10.1/dist/ffmpeg.min.js"></script>
<script>
const { createFFmpeg, fetchFile } = FFmpeg;
const ffmpeg = createFFmpeg({ log: true });

const videoInput = document.getElementById('videoInput');
const audioInput = document.getElementById('audioInput');
const mergeBtn = document.getElementById('mergeBtn');
const status = document.getElementById('status');

mergeBtn.addEventListener('click', async () => {
    if (!videoInput.files[0] || !audioInput.files[0]) {
        alert('Please select both video and audio files.');
        return;
    }

    status.textContent = 'Loading FFmpeg (may take a few seconds)...';
    if (!ffmpeg.isLoaded()) await ffmpeg.load();

    status.textContent = 'Processing video...';

    const videoFile = videoInput.files[0];
    const audioFile = audioInput.files[0];

    // Write files to FFmpeg FS
    ffmpeg.FS('writeFile', 'video.mp4', await fetchFile(videoFile));
    ffmpeg.FS('writeFile', 'audio.mp3', await fetchFile(audioFile));

    // Merge video and audio
    await ffmpeg.run(
        '-i', 'video.mp4',
        '-i', 'audio.mp3',
        '-c:v', 'copy',
        '-c:a', 'aac',
        '-shortest',
        'output.mp4'
    );

    // Read output file
    const data = ffmpeg.FS('readFile', 'output.mp4');
    const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));

    // Trigger download
    const a = document.createElement('a');
    a.href = url;
    a.download = 'merged_video.mp4';
    a.click();

    status.textContent = 'Done! Download should start automatically.';
});
</script>
</body>
</html>
